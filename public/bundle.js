var app=function(){"use strict";function t(){}const e=t=>t;function n(t,e){for(const n in e)t[n]=e[n];return t}function s(t){return t()}function r(){return Object.create(null)}function i(t){t.forEach(s)}function o(t){return"function"==typeof t}function a(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(t,e,n){const s=e.subscribe(n);t.$$.on_destroy.push(s.unsubscribe?()=>s.unsubscribe():s)}let c="undefined"!=typeof window?()=>window.performance.now():()=>Date.now(),d=t=>requestAnimationFrame(t);const u=new Set;let h,f=!1;function m(){u.forEach(t=>{t[0](c())||(u.delete(t),t[1]())}),(f=u.size>0)&&d(m)}function g(t,e){t.appendChild(e)}function p(t,e,n){t.insertBefore(e,n||null)}function b(t){t.parentNode.removeChild(t)}function v(t,e){for(;t.nextSibling&&t.nextSibling!==e;)t.parentNode.removeChild(t.nextSibling)}function y(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function w(t){return document.createElement(t)}function $(t){return document.createTextNode(t)}function k(){return $(" ")}function _(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function x(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}function A(t,e){e=""+e,t.data!==e&&(t.data=e)}function N(t,e,n){t.style.setProperty(e,n)}function M(t){h=t}const S=[],C=[],O=[],T=[],z=Promise.resolve();let E=!1;function R(t){O.push(t)}function j(){const t=new Set;do{for(;S.length;){const t=S.shift();M(t),F(t.$$)}for(;C.length;)C.pop()();for(let e=0;e<O.length;e+=1){const n=O[e];t.has(n)||(n(),t.add(n))}O.length=0}while(S.length);for(;T.length;)T.pop()();E=!1}function F(t){t.fragment&&(t.update(t.dirty),i(t.before_update),t.fragment.p(t.dirty,t.ctx),t.dirty=null,t.after_update.forEach(R))}const P=new Set;const B="undefined"!=typeof window?window:global;function H(t,e){t.$$.dirty||(S.push(t),E||(E=!0,z.then(j)),t.$$.dirty=r()),t.$$.dirty[e]=!0}function U(e,n,a,l,c,d){const u=h;M(e);const f=n.props||{},m=e.$$={fragment:null,ctx:null,props:d,update:t,not_equal:c,bound:r(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:r(),dirty:null};let g=!1;var p,b,v;m.ctx=a?a(e,f,(t,n)=>{m.ctx&&c(m.ctx[t],m.ctx[t]=n)&&(m.bound[t]&&m.bound[t](n),g&&H(e,t))}):f,m.update(),g=!0,i(m.before_update),m.fragment=l(m.ctx),n.target&&(n.hydrate?m.fragment.l((v=n.target,Array.from(v.childNodes))):m.fragment.c(),n.intro&&((p=e.$$.fragment)&&p.i&&(P.delete(p),p.i(b))),function(t,e,n){const{fragment:r,on_mount:a,on_destroy:l,after_update:c}=t.$$;r.m(e,n),R(()=>{const e=a.map(s).filter(o);l?l.push(...e):i(e),t.$$.on_mount=[]}),c.forEach(R)}(e,n.target,n.anchor),j()),M(u)}class L{$destroy(){var e,n;n=1,(e=this).$$.fragment&&(i(e.$$.on_destroy),e.$$.fragment.d(n),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={}),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function D(e,n=t){let s;const r=[];function i(t){if(a(e,t)){if(e=t,!s)return;r.forEach(t=>t[1]()),r.forEach(t=>t[0](e))}}return{set:i,update:function(t){i(t(e))},subscribe:function(o,a=t){const l=[o,a];return r.push(l),1===r.length&&(s=n(i)||t),o(e),()=>{const t=r.indexOf(l);-1!==t&&r.splice(t,1),0===r.length&&(s(),s=null)}}}}function I(t){return"[object Date]"===Object.prototype.toString.call(t)}function W(t,e){if(t===e||t!=t)return()=>t;const n=typeof t;if(n!==typeof e||Array.isArray(t)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(t)){const n=e.map((e,n)=>W(t[n],e));return t=>n.map(e=>e(t))}if("object"===n){if(!t||!e)throw new Error("Object cannot be null");if(I(t)&&I(e)){t=t.getTime();const n=(e=e.getTime())-t;return e=>new Date(t+e*n)}const n=Object.keys(e),s={};return n.forEach(n=>{s[n]=W(t[n],e[n])}),t=>{const e={};return n.forEach(n=>{e[n]=s[n](t)}),e}}if("number"===n){const n=e-t;return e=>t+e*n}throw new Error(`Cannot interpolate ${n} values`)}function q(t,s={}){const r=D(t);let i,o=t;function a(a,l){o=a;let h=i,g=!1,{delay:p=0,duration:b=400,easing:v=e,interpolate:y=W}=n(n({},s),l);const w=c()+p;let $;return(i=function(t){let e;return f||(f=!0,d(m)),{promise:new Promise(n=>{u.add(e=[t,n])}),abort(){u.delete(e)}}}(e=>{if(e<w)return!0;g||($=y(t,a),"function"==typeof b&&(b=b(t,a)),g=!0),h&&(h.abort(),h=null);const n=e-w;return n>b?(r.set(t=a),!1):(r.set(t=$(v(n/b))),!0)})).promise}return{set:a,update:(e,n)=>a(e(o,t),n),subscribe:r.subscribe}}let K={duration:100,easing:t=>t};const Y=D({}),J=D({}),Q=D([]),X=D(null);let Z;const V=D(!0);V.set("no"!=localStorage.what),V.subscribe(t=>localStorage.setItem("what",t?"yes":"no"));const G=D(!1),tt=D([]);let et="game ",nt=et.length;function st(){let t=[];for(let e in localStorage)if("auto"==e||e.substr(0,nt)==et){let n=JSON.parse(localStorage[e]),s=(Number(e.substr(nt)),"?");try{s=`t${n.turns.length} ${n.conf.width}x${n.conf.height} #${n.conf.seed} ${n.date.toLocaleString()}`}catch(t){console.error(t)}"auto"==e?t.unshift([e,s]):t.push([e,s])}t.push([rt(),"#NEW"]),tt.set(t)}function rt(){let t=0;for(let e in localStorage)if(e.substr(0,nt)==et){let n=Number(e.substr(nt));n>=t&&(t=n+1)}return et+t}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var it,ot=(function(t,e){t.exports=function(){var t=624,e=397,n=function(e){void 0===e&&(e=(new Date).getTime()),this.mt=new Array(t),this.mti=625,this.seed(e)};n.prototype.seed=function(e){var n;for(this.mt[0]=e>>>0,this.mti=1;this.mti<t;this.mti++)n=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(1812433253*((4294901760&n)>>>16)<<16)+1812433253*(65535&n)+this.mti,this.mt[this.mti]>>>=0},n.prototype.seedArray=function(e){var n,s=1,r=0,i=t>e.length?t:e.length;for(this.seed(19650218);i>0;i--)n=this.mt[s-1]^this.mt[s-1]>>>30,this.mt[s]=(this.mt[s]^(1664525*((4294901760&n)>>>16)<<16)+1664525*(65535&n))+e[r]+r,this.mt[s]>>>=0,r++,++s>=t&&(this.mt[0]=this.mt[623],s=1),r>=e.length&&(r=0);for(i=623;i;i--)n=this.mt[s-1]^this.mt[s-1]>>>30,this.mt[s]=(this.mt[s]^(1566083941*((4294901760&n)>>>16)<<16)+1566083941*(65535&n))-s,this.mt[s]>>>=0,++s>=t&&(this.mt[0]=this.mt[623],s=1);this.mt[0]=2147483648},n.prototype.int=function(){var n,s,r=new Array(0,2567483615);if(this.mti>=t){for(625===this.mti&&this.seed(5489),s=0;s<227;s++)n=2147483648&this.mt[s]|2147483647&this.mt[s+1],this.mt[s]=this.mt[s+e]^n>>>1^r[1&n];for(;s<623;s++)n=2147483648&this.mt[s]|2147483647&this.mt[s+1],this.mt[s]=this.mt[s+(e-t)]^n>>>1^r[1&n];n=2147483648&this.mt[623]|2147483647&this.mt[0],this.mt[623]=this.mt[396]^n>>>1^r[1&n],this.mti=0}return n=this.mt[this.mti++],n^=n>>>11,n^=n<<7&2636928640,n^=n<<15&4022730752,(n^=n>>>18)>>>0},n.prototype.int31=function(){return this.int()>>>1},n.prototype.real=function(){return this.int()*(1/4294967295)},n.prototype.realx=function(){return(this.int()+.5)*(1/4294967296)},n.prototype.rnd=function(){return this.int()*(1/4294967296)},n.prototype.random=n.prototype.rnd,n.prototype.rndHiRes=function(){var t=this.int()>>>5,e=this.int()>>>6;return(67108864*t+e)*(1/9007199254740992)};var s=new n;return n.random=function(){return s.rnd()},n}()}(it={exports:{}},it.exports),it.exports);class at{constructor(t){this.bats=t,this.time=0,this.log=[],this.hp=[];for(let e of t)e.hp=e.vit,e.nextAttack=e.interval();t[0].seed(t[1]),t[1].seed(t[0]);let e=30;for(;!this.over()&&e-- >0;){let e=Math.min(...t.map(t=>t.nextAttack));this.time=e;for(let e of t)if(e.nextAttack<=this.time&&!(e.hp<=0)){let n=t[0]==e?t[1]:t[0];this.log.push(e.attack(n,this))}}this.hp=this.bats.map(t=>t.hp),t[0].hp<=0?this.outcome="lose":t[1].hp<=0?this.outcome="win":this.outcome="draw"}over(){return this.log.length>=20||!this.bats.every(t=>t.hp>0)}}class lt{constructor(t){this.fig=t,this.twister=new ot}stats(t){return Object.assign(this,t),this}interval(){return 1e4/this.spd}rni(){return this.twister.int()}seed(t){let e=100+2*Math.abs(t.fig?t.fig.id:-1)+(this.fig?this.fig.id:-1);this.twister.seed(e)}get isProto(){return!this.fig}update(){let t={};for(let e in lt.statsBase)t[e]=0;t[this.fig.kind]=4*this.fig.cells.length;for(let e of this.fig.neighbors)e.resolved||(t[e.kind]+=e.cells.length);for(let e in lt.statsBase)this[e]=Math.floor(lt.statsBase[e]*(10+2*t[e])*Math.pow(10,1+this.fig.depth/20)/100);return this.battle=new at([this.fig.game.prota,this]),this}attack(t,e){this.nextAttack=e.time+this.interval();let n=0,s=this.rni(),r=Math.floor(s%2e6*this.str/1e6);return(n=Math.max(0,r-t.def))>0&&(t.hp-=n),{a:this,d:t,damage:n,damageRoll:r,def:t.def,hp:t.hp}}}lt.statsOrder="str vit def spd".split(" "),lt.statsBase={str:10,vit:30,def:10,spd:10,dream:0};class ct{constructor(t,e,n){this.game=t,this.kind=e,this.id=n,this.cells=[],this.neighbors=[],this.resolved=!1,this.reached=!1}addNeighbor(t){t&&!this.neighbors.includes(t)&&(this.neighbors.push(t),t.neighbors.push(this))}reach(){this.reached||(this.reached=!0,"none"==this.kind&&this.resolve())}resolve(){if(!this.resolved){this.battler||this.updateBattler(),this.resolved=!0;for(let t of this.neighbors)t.reach();this.loot()}}updateBattler(){if(this.resolved||"none"==this.kind)return this.battler=null,this;let t={};for(let e in lt.statsBase)t[e]=0;t[this.kind]=4*this.cells.length;for(let e of this.neighbors)e.resolved||(t[e.kind]+=e.cells.length);this.battler||(this.battler=new lt(this));for(let e in lt.statsBase)this.battler[e]=Math.floor(lt.statsBase[e]*(10+2*t[e])*Math.pow(10,1+this.depth/20)/100);return this.battle=new at([this.game.prota,this.battler]),this}get possible(){return this.reached&&!this.resolved&&this.battle&&"win"==this.battle.outcome}loot(){let t=this.kind;"none"!=t&&(this.game.prota[t]+=Math.floor(this.battler[t]/10),this.game.score+=this.score)}get score(){return this.cells.length*(this.dream?100:1)}get xp(){let t=this.kind;return[t,Math.floor(this.battler[t]/10)]}get frozen(){return!this.resolved&&this.game.frozen(this.last)}get dream(){return"dream"==this.kind}get color(){return this.game.colors[this.kind]}}const dt={str:"red",vit:"green",def:"yellow",spd:"blue",none:"none",dream:"rainbow"};class ut{constructor(t,e){this.twister=new ot,this.board=[],this.figs=[],this.turns=[],this.persist=null,e&&(this.persist=e),this.config(t),X.set(this)}persistIn(t){return this.persist=t,this}get colors(){return dt}start(){this.generate(),this.play(),this.saveAuto()}config(t){return this.conf=t,this}load(t){if("string"==typeof t){let e=ut.loadRaw(t);return!!e&&(this.deserialize(e),!0)}this.deserialize(t)}static loadRaw(t){if(!t)return null;let e=localStorage.getItem(t);return e&&"undefined"!=e?JSON.parse(e):null}save(t){t||(t=rt()),localStorage.setItem(t,JSON.stringify(this.serialized()))}erase(t){localStorage.removeItem(t)}get savedFields(){return"conf turns cash".split(" ")}serialized(){let t={date:new Date};for(let e of this.savedFields)t[e]=this[e];return t}get cellsNumber(){return this.width*this.height}get width(){return this.conf.width}get height(){return this.conf.height}deserialize(t){console.log(t);for(let e in t)this[e]=t[e];this.generate(),this.play(t.turns)}get dreamFrequency(){return 200}generate(){this.turns=[],this.figs=[],this.twister.seed(this.conf.seed),this.rni=this.twister.int.bind(this.twister),this.deltas=[-1,1,-this.width,+this.width];let t=[...Array(this.cellsNumber)].map(t=>(function(t,e){let n=e()%t.reduce((t,e)=>t+e)-t[0],s=0;for(;n>=0;)n-=t[++s];return s})([1,0,1,1,1,1],this.rni));for(let e=0;e<this.cellsNumber;e+=Math.floor(this.dreamFrequency/2)+this.rni()%this.dreamFrequency)0!=e&&(t[e]=1);this.board=t.map(t=>null);for(let e in t)this.populate(t,Number(e))}populate(t,e){if(this.board[e])return;let n=t[e],s=[e],r=new ct(this,["none","dream","str","vit","def","spd"][n],this.figs.length);for(this.figs.push(r);s.length>0;){let e=s.pop();this.board[e]=r,r.cells.push(e);for(let i of this.deltas){let o=e+i;1==Math.abs(i)&&Math.floor(e/this.width)!=Math.floor(o/this.width)||(this.board[o]?r.addNeighbor(this.board[o]):t[o]==n&&s.push(o))}}r.last=r.cells.reduce((t,e)=>t>e?t:e);let i=r.cells.map(t=>this.row(t));r.depth=Math.round(i.reduce((t,e)=>t+e)/r.cells.length)}row(t){return Math.floor(t/this.width)}play(t=[]){this.turns=t,this.score=0,this.dreamsTotal=0,this.prota=(new lt).stats({str:20,vit:50,def:10,spd:30});for(let t of this.figs)t.reached=!1,t.resolved=!1,t.battle=null,t.dream&&this.dreamsTotal++;for(let t=0;t<this.width;t++)this.board[t].reach();for(let e of t)this.figs[e]&&this.figs[e].resolve();this.saveAuto(),this.stateChanged()}attackFigAt(t){let e=this.board[t];return e?e.frozen?null:e&&e.possible?(e.resolve(),this.score-=3,this.turns.push(e.id),this.stateChanged(),this.saveAuto(),e):null:null}saveAuto(){this.save(this.persist)}updateBattles(){for(let t of this.figs)t.reached&&!t.resolved&&t.updateBattler()}undo(){this.turns.length>0&&this.play(this.turns.slice(0,-1))}reset(){this.play()}logFigAt(t){let e=this.board[t];e.updateBattler(),console.log(e)}fig(t){return this.figs[t]}figAt(t){return this.board[t]}stateChanged(){this.updateBattles(),Y.set(this.conf),Q.set(this.board),this.dreamsResolved=0,this.dreamsFrozen=0;for(let t of this.figs)t.dream&&(t.resolved?this.dreamsResolved++:t.frozen&&this.dreamsFrozen++);var t;this.complete=this.dreamsResolved+this.dreamsFrozen==this.dreamsTotal,t={turns:this.turns.length,score:this.score,str:this.prota.str,vit:this.prota.vit,def:this.prota.def,spd:this.prota.spd,complete:this.complete?1:0},Z?Z.set(t):Z=q(t,K),J.set(this.debrief)}frozen(t){return t<this.width*Math.floor(this.turns.length/3-5)}get debrief(){let t={score:this.score,dreamsResolved:this.dreamsResolved,dreamsFrozen:this.dreamsFrozen,turns:this.turns.length,challengeUrl:this.challengeUrl};for(let e of lt.statsOrder)t[e]=0;for(let e of this.figs)e.resolved&&(t[e.kind]+=e.cells.length);return t}get challengeUrl(){let t=new URLSearchParams(this.conf);return t.append("goal",this.score.toString()),window.location.host+window.location.pathname+"?"+t.toString()}static create(){let t,e={width:30,height:80,seed:1};if(document.location.search){let e=new URLSearchParams(document.location.search.substr(1));t=Object.fromEntries(e.entries())}let n=ut.loadRaw("auto");if(!n){let n=new ut(t||e,"auto");return n.start(),n}let s=!t||function(t,e){for(let n in t)if(t[n]!=e[n])return!1;return!0}(n.conf,t),r=new ut(t||n.conf,"auto");return s?r.load(n):r.start(),r}colorAt(t){return this.figAt(t).color}}let ht={what:"\n<ol type=\"I\">\n<li>Objective is to reach the bottom of the board and get as much money as possible until you run out of turns.\n<li>Each colored shape is a monster.\n<li>If the monster is highlighted, it means that it's in your reach and you are powerful enough to win. Click to do it.\n<li>You will expend one turn on fight and will be rewarded with some of enemy's stats and some money. \n<li>You can see enemy stats, battle projection and expected loot simply by mouse-overing it.\n<li>Combat is automatic. \n<li>VIT is how many HP you start with.\nYou attack as often as your SPD is, deal damage to enemy HP at random between 0% and 200% of STR, minus target's DEF.\n<li>Enemy does the same. \n<li>There is a draw if no one loses after 20 attacks are made. It's equivalent to your defeat in most cases.\n</ol>\n  ",what_files:'\n<ol type="I">\n  <li>After each your move game is saved to the AUTO slot. \n  <li>You can save in new slot, load any save or delete them with X.\n</ol>  \n  ',tip_str:"Each attack deals random damage between 0% and 200% of this value (before Defense applied).",tip_vit:"Amount of HP when combat starts.",tip_def:"Damage from each attack is reduced by this.",tip_spd:"Frequency of attacks.",tip_score:"Score is +1 per cleared cell, +100 per cleared rainbow cell, -3 per turn",tip_erase:"Delete file",tip_frozen:"One row of board is frozen per 3 turns.<br/>Frozen cells are completely unaccessible.",tip_ability:"Not implemented yet",FROZEN:"FROZEN"};const{Object:ft}=B;function mt(t,e,n){const s=ft.create(t);return s.save=e[n],s}function gt(t,e,n){const s=ft.create(t);return s.fig=e[n],s.i=n,s}function pt(t,e,n){const s=ft.create(t);return s.anim=e[n],s}function bt(t,e,n){const s=ft.create(t);return s.field=e[n],s}function vt(t,e,n){const s=ft.create(t);return s.stat=e[n],s.i=n,s}function yt(t,e,n){const s=ft.create(t);return s.move=e[n],s}function wt(t,e,n){const s=ft.create(t);return s.field=e[n],s.i=n,s}function $t(t){var e,n;function s(t){return t.enemy.frozen?_t:kt}var r=s(t),i=r(t);return{c(){e=w("div"),i.c(),x(e,"style",t.analysisPosition()),x(e,"class",n="analysis "+(t.moveTimeout?"":"analysis-shown"))},m(n,s){p(n,e,s),i.m(e,null),t.div_binding(e)},p(t,o){r===(r=s(o))&&i?i.p(t,o):(i.d(1),(i=r(o))&&(i.c(),i.m(e,null))),t.moveTimeout&&n!==(n="analysis "+(o.moveTimeout?"":"analysis-shown"))&&x(e,"class",n)},d(n){n&&b(e),i.d(),t.div_binding(null)}}}function kt(t){for(var e,n,s,r,i,o,a=lt.statsOrder,l=[],c=0;c<a.length;c+=1)l[c]=xt(wt(t,a,c));var d=t.enemy.battle.log,u=[];for(c=0;c<d.length;c+=1)u[c]=Tt(yt(t,d,c));var h=("win"!=t.enemy.battle.outcome||!t.$abridgedAnalysis)&&zt(t),f="win"==t.enemy.battle.outcome&&Et(t);return{c(){e=w("div");for(var t=0;t<l.length;t+=1)l[t].c();n=k(),s=w("div");for(t=0;t<u.length;t+=1)u[t].c();r=k(),i=w("div"),h&&h.c(),o=k(),f&&f.c(),x(e,"class","enemy"),x(s,"class","combat-log"),x(i,"class","battle-outcome")},m(t,a){p(t,e,a);for(var c=0;c<l.length;c+=1)l[c].m(e,null);p(t,n,a),p(t,s,a);for(c=0;c<u.length;c+=1)u[c].m(s,null);p(t,r,a),p(t,i,a),h&&h.m(i,null),g(i,o),f&&f.m(i,null)},p(t,n){if(t.fg||t.Battler||t.bigNum||t.enemy||t.$abridgedAnalysis){a=lt.statsOrder;for(var r=0;r<a.length;r+=1){const s=wt(n,a,r);l[r]?l[r].p(t,s):(l[r]=xt(s),l[r].c(),l[r].m(e,null))}for(;r<l.length;r+=1)l[r].d(1);l.length=a.length}if(t.$abridgedAnalysis||t.enemy||t.bigNum||t.fg){d=n.enemy.battle.log;for(r=0;r<d.length;r+=1){const e=yt(n,d,r);u[r]?u[r].p(t,e):(u[r]=Tt(e),u[r].c(),u[r].m(s,null))}for(;r<u.length;r+=1)u[r].d(1);u.length=d.length}"win"==n.enemy.battle.outcome&&n.$abridgedAnalysis?h&&(h.d(1),h=null):h?h.p(t,n):((h=zt(n)).c(),h.m(i,o)),"win"==n.enemy.battle.outcome?f?f.p(t,n):((f=Et(n)).c(),f.m(i,null)):f&&(f.d(1),f=null)},d(t){t&&b(e),y(l,t),t&&(b(n),b(s)),y(u,t),t&&(b(r),b(i)),h&&h.d(),f&&f.d()}}}function _t(e){var n,s,r,i=ht.FROZEN,o=ht.tip_frozen;return{c(){n=w("div"),s=k(),r=w("div"),x(n,"class","enemy"),x(r,"class","combat-log")},m(t,e){p(t,n,e),n.innerHTML=i,p(t,s,e),p(t,r,e),r.innerHTML=o},p:t,d(t){t&&(b(n),b(s),b(r))}}}function xt(t){var e,n,s,r,i,o,a,l,c,d=0==t.i?"":"&nbsp;",u=t.$abridgedAnalysis?"":t.field,h=t.bigNum(t.enemy.battler[t.field]);return{c(){e=w("noscript"),n=w("noscript"),s=k(),r=w("span"),i=$(u),o=k(),a=w("span"),l=$(h),x(r,"class","field-name"),x(a,"class",c=t.fg[t.field])},m(t,c){p(t,e,c),e.insertAdjacentHTML("afterend",d),p(t,n,c),p(t,s,c),p(t,r,c),g(r,i),p(t,o,c),p(t,a,c),g(a,l)},p(t,e){t.$abridgedAnalysis&&u!==(u=e.$abridgedAnalysis?"":e.field)&&A(i,u),t.enemy&&h!==(h=e.bigNum(e.enemy.battler[e.field]))&&A(l,h),t.fg&&c!==(c=e.fg[e.field])&&x(a,"class",c)},d(t){t&&(v(e,n),b(e),b(n),b(s),b(r),b(o),b(a))}}}function At(t){var e,n,s,r,i,o,a,l,c,d,u,h,f,m,v=t.move.a.isProto?"Made":"Took",y=t.bigNum(t.move.damageRoll),_=t.bigNum(t.move.def);function N(t){return t.move.damage<=0?St:Mt}var M=N(t),S=M(t);return{c(){e=w("div"),n=w("nobr"),s=w("span"),r=$(v),o=k(),a=w("span"),l=$(y),d=$("\r\n                -\r\n                "),u=w("span"),h=$(_),m=k(),S.c(),x(s,"class",i=t.move.a.isProto?"attacking":"defending"),x(a,"class",c=t.fg.str),x(u,"class",f=t.fg.def),x(e,"class","complete-log")},m(t,i){p(t,e,i),g(e,n),g(n,s),g(s,r),g(n,o),g(n,a),g(a,l),g(n,d),g(n,u),g(u,h),g(n,m),S.m(n,null)},p(t,e){t.enemy&&v!==(v=e.move.a.isProto?"Made":"Took")&&A(r,v),t.enemy&&i!==(i=e.move.a.isProto?"attacking":"defending")&&x(s,"class",i),t.enemy&&y!==(y=e.bigNum(e.move.damageRoll))&&A(l,y),t.fg&&c!==(c=e.fg.str)&&x(a,"class",c),t.enemy&&_!==(_=e.bigNum(e.move.def))&&A(h,_),t.fg&&f!==(f=e.fg.def)&&x(u,"class",f),M===(M=N(e))&&S?S.p(t,e):(S.d(1),(S=M(e))&&(S.c(),S.m(n,null)))},d(t){t&&b(e),S.d()}}}function Nt(t){var e,n;function s(t){return t.move.damage>0?Ot:Ct}var r=s(t),i=r(t);return{c(){e=w("span"),i.c(),x(e,"class",n=t.move.a.isProto?"attacking":"defending")},m(t,n){p(t,e,n),i.m(e,null)},p(t,o){r===(r=s(o))&&i?i.p(t,o):(i.d(1),(i=r(o))&&(i.c(),i.m(e,null))),t.enemy&&n!==(n=o.move.a.isProto?"attacking":"defending")&&x(e,"class",n)},d(t){t&&b(e),i.d()}}}function Mt(t){var e,n,s,r,i,o,a,l,c,d=t.bigNum(t.move.damage),u=t.bigNum(t.move.hp);return{c(){e=$("=\r\n                  "),n=w("span"),s=$(d),i=$("\r\n                  dmg,\r\n                  "),o=w("span"),a=$(u),c=$("\r\n                  hp left"),x(n,"class",r=t.fg.str),x(o,"class",l=t.move.a.isProto?"attacking":"defending")},m(t,r){p(t,e,r),p(t,n,r),g(n,s),p(t,i,r),p(t,o,r),g(o,a),p(t,c,r)},p(t,e){t.enemy&&d!==(d=e.bigNum(e.move.damage))&&A(s,d),t.fg&&r!==(r=e.fg.str)&&x(n,"class",r),t.enemy&&u!==(u=e.bigNum(e.move.hp))&&A(a,u),t.enemy&&l!==(l=e.move.a.isProto?"attacking":"defending")&&x(o,"class",l)},d(t){t&&(b(e),b(n),b(i),b(o),b(c))}}}function St(t){var e,n,s,r;return{c(){e=$("=\r\n                  "),n=w("span"),s=$("no damage"),x(n,"class",r=t.fg.def)},m(t,r){p(t,e,r),p(t,n,r),g(n,s)},p(t,e){t.fg&&r!==(r=e.fg.def)&&x(n,"class",r)},d(t){t&&(b(e),b(n))}}}function Ct(e){var n;return{c(){n=$("=")},m(t,e){p(t,n,e)},p:t,d(t){t&&b(n)}}}function Ot(t){var e,n=t.bigNum(t.move.hp);return{c(){e=$(n)},m(t,n){p(t,e,n)},p(t,s){t.enemy&&n!==(n=s.bigNum(s.move.hp))&&A(e,n)},d(t){t&&b(e)}}}function Tt(t){var e,n;function s(t){return t.$abridgedAnalysis?Nt:At}var r=s(t),i=r(t);return{c(){i.c(),e=k(),n=w("span")},m(t,s){i.m(t,s),p(t,e,s),p(t,n,s)},p(t,n){r===(r=s(n))&&i?i.p(t,n):(i.d(1),(i=r(n))&&(i.c(),i.m(e.parentNode,e)))},d(t){i.d(t),t&&(b(e),b(n))}}}function zt(t){var e,n,s,r=t.enemy.battle.outcome.toUpperCase();return{c(){e=w("span"),n=$(r),x(e,"class",s="battle-"+t.enemy.battle.outcome)},m(t,s){p(t,e,s),g(e,n)},p(t,i){t.enemy&&r!==(r=i.enemy.battle.outcome.toUpperCase())&&A(n,r),t.enemy&&s!==(s="battle-"+i.enemy.battle.outcome)&&x(e,"class",s)},d(t){t&&b(e)}}}function Et(t){var e,n,s,r,i,o,a,l,c,d=t.$abridgedAnalysis?"":t.enemy.xp[0],u=(t.$abridgedAnalysis?"":"+")+t.bigNum(t.enemy.xp[1]),h=t.enemy.score;return{c(){e=$(d),n=k(),s=w("span"),r=$(u),o=$("\r\n          score\r\n          "),a=w("span"),l=$("+ "),c=$(h),x(s,"class",i=t.fg[t.enemy.xp[0]]),x(a,"class",t.rainbow)},m(t,i){p(t,e,i),p(t,n,i),p(t,s,i),g(s,r),p(t,o,i),p(t,a,i),g(a,l),g(a,c)},p(t,n){(t.$abridgedAnalysis||t.enemy)&&d!==(d=n.$abridgedAnalysis?"":n.enemy.xp[0])&&A(e,d),(t.$abridgedAnalysis||t.enemy)&&u!==(u=(n.$abridgedAnalysis?"":"+")+n.bigNum(n.enemy.xp[1]))&&A(r,u),(t.fg||t.enemy)&&i!==(i=n.fg[n.enemy.xp[0]])&&x(s,"class",i),t.enemy&&h!==(h=n.enemy.score)&&A(c,h)},d(t){t&&(b(e),b(n),b(s),b(o),b(a))}}}function Rt(t){var e,n;return{c(){e=w("div"),n=$(t.page),x(e,"class","page-title")},m(t,s){p(t,e,s),g(e,n)},p(t,e){t.page&&A(n,e.page)},d(t){t&&b(e)}}}function jt(t){for(var e,n,s,r,i,o,a,l=t.statsOrder,c=[],d=0;d<l.length;d+=1)c[d]=Ft(vt(t,l,d));return{c(){(e=w("button")).textContent="undo",n=k(),s=w("div");for(var l=0;l<c.length;l+=1)c[l].c();r=k(),i=w("button"),o=$("ability"),x(e,"class","hotkey"),x(s,"class","prota"),x(i,"class","hotkey wip tooltip-bottom"),i.dataset.tooltip=ht.tip_ability,a=_(e,"click",t.undo)},m(t,a){p(t,e,a),p(t,n,a),p(t,s,a);for(var l=0;l<c.length;l+=1)c[l].m(s,null);p(t,r,a),p(t,i,a),g(i,o)},p(t,e){if(t.fg||t.statsOrder||t.lang||t.bigNum||t.$state){l=e.statsOrder;for(var n=0;n<l.length;n+=1){const r=vt(e,l,n);c[n]?c[n].p(t,r):(c[n]=Ft(r),c[n].c(),c[n].m(s,null))}for(;n<c.length;n+=1)c[n].d(1);c.length=l.length}},d(t){t&&(b(e),b(n),b(s)),y(c,t),t&&(b(r),b(i)),a()}}}function Ft(t){var e,n,s,r,i,o,a,l,c,d,u=t.i>0?"&nbsp":"",h=t.stat,f=t.bigNum(t.$state[t.stat]);return{c(){e=w("noscript"),n=w("noscript"),s=k(),r=w("span"),i=$(h),o=k(),a=w("span"),l=$(f),c=k(),x(r,"class","field-name"),x(a,"class",d=t.fg[t.stat]+" tooltip-bottom"),a.dataset.tooltip=ht["tip_"+t.stat]},m(t,d){p(t,e,d),e.insertAdjacentHTML("afterend",u),p(t,n,d),p(t,s,d),p(t,r,d),g(r,i),p(t,o,d),p(t,a,d),g(a,l),g(a,c)},p(t,e){t.$state&&f!==(f=e.bigNum(e.$state[e.stat]))&&A(l,f),t.fg&&d!==(d=e.fg[e.stat]+" tooltip-bottom")&&x(a,"class",d)},d(t){t&&(v(e,n),b(e),b(n),b(s),b(r),b(o),b(a))}}}function Pt(t){var e,n,s,r,i,o,a,l,c,d=t.bigNum(t.$state.score),u=t.Math.round(t.$state.turns);return{c(){(e=w("span")).textContent="score",n=k(),s=w("span"),r=$(d),i=k(),(o=w("span")).textContent="turns",a=k(),l=w("span"),c=$(u),x(e,"class","field-name"),x(s,"class",t.rainbow+" tooltip-bottom"),s.dataset.tooltip=ht.tip_score,x(o,"class","field-name")},m(t,d){p(t,e,d),p(t,n,d),p(t,s,d),g(s,r),p(t,i,d),p(t,o,d),p(t,a,d),p(t,l,d),g(l,c)},p(t,e){t.$state&&d!==(d=e.bigNum(e.$state.score))&&A(r,d),t.$state&&u!==(u=e.Math.round(e.$state.turns))&&A(c,u)},d(t){t&&(b(e),b(n),b(s),b(i),b(o),b(a),b(l))}}}function Bt(t){var e,n,s,r,i,o,a,l=t.bigNum(t.$debrief[t.field]),c=t.field;return{c(){e=$("+ "),n=$(l),s=k(),r=w("span"),i=$(c),a=$("\r\n      cells "),x(r,"class",o=t.fg[t.field])},m(t,o){p(t,e,o),p(t,n,o),p(t,s,o),p(t,r,o),g(r,i),p(t,a,o)},p(t,e){t.$debrief&&l!==(l=e.bigNum(e.$debrief[e.field]))&&A(n,l),t.fg&&o!==(o=e.fg[e.field])&&x(r,"class",o)},d(t){t&&(b(e),b(n),b(s),b(r),b(a))}}}function Ht(t){for(var e,n,s,r,o,a,l,c,d,u,h,f,m,v,A=t.justResolved,M=[],S=0;S<A.length;S+=1)M[S]=Ut(pt(t,A,S));var C=t.$board,O=[];for(S=0;S<C.length;S+=1)O[S]=Lt(gt(t,C,S));return{c(){e=w("div"),n=w("div");for(var i=0;i<M.length;i+=1)M[i].c();s=k();for(i=0;i<O.length;i+=1)O[i].c();r=k(),o=w("div"),a=$("Seed\r\n      "),l=w("input"),c=$("\r\n       Width\r\n      "),d=w("input"),u=$("\r\n       Height\r\n      "),h=w("input"),f=$("\r\n       \r\n      "),(m=w("button")).textContent="play",x(n,"class","animations"),x(e,"class","board-table"),N(e,"width",20*t.$conf.width+"px"),x(o,"class","board-conf"),v=[_(e,"mousemove",t.hoverCell),_(e,"mousedown",t.clickCell),_(e,"mouseleave",t.unHoverCell),_(l,"input",t.input0_input_handler),_(d,"input",t.input1_input_handler),_(h,"input",t.input2_input_handler),_(m,"click",t.playCustom)]},m(i,b){p(i,e,b),g(e,n);for(var v=0;v<M.length;v+=1)M[v].m(n,null);g(e,s);for(v=0;v<O.length;v+=1)O[v].m(e,null);p(i,r,b),p(i,o,b),g(o,a),g(o,l),l.value=t.custom.seed,g(o,c),g(o,d),d.value=t.custom.width,g(o,u),g(o,h),h.value=t.custom.height,g(o,f),g(o,m)},p(t,s){if(t.justResolved){A=s.justResolved;for(var r=0;r<A.length;r+=1){const e=pt(s,A,r);M[r]?M[r].p(t,e):(M[r]=Ut(e),M[r].c(),M[r].m(n,null))}for(;r<M.length;r+=1)M[r].d(1);M.length=A.length}if(t.cellClasses||t.$board||t.enemy){C=s.$board;for(r=0;r<C.length;r+=1){const n=gt(s,C,r);O[r]?O[r].p(t,n):(O[r]=Lt(n),O[r].c(),O[r].m(e,null))}for(;r<O.length;r+=1)O[r].d(1);O.length=C.length}t.$conf&&N(e,"width",20*s.$conf.width+"px"),t.custom&&l.value!==s.custom.seed&&(l.value=s.custom.seed),t.custom&&d.value!==s.custom.width&&(d.value=s.custom.width),t.custom&&h.value!==s.custom.height&&(h.value=s.custom.height)},d(t){t&&b(e),y(M,t),y(O,t),t&&(b(r),b(o)),i(v)}}}function Ut(t){var e,n,s;return{c(){x(e=w("div"),"class","death"),x(e,"style",n=t.anim)},m(t,n){p(t,e,n),s=function(t){t.animate([{opacity:1,transform:"translate(0) rotate3d(1, 0, 0, 0deg)"},{opacity:0,transform:`translate(${60*Math.random()-30}px, -70px) rotate3d(${180*Math.random()-90}, ${180*Math.random()-90}, ${180*Math.random()-90}, ${180*Math.random()-90}deg)`}],{duration:200,easing:"ease-out",fill:"forwards"})}.call(null,e)||{}},p(t,s){t.justResolved&&n!==(n=s.anim)&&x(e,"style",n)},d(t){t&&b(e),s&&"function"==typeof s.destroy&&s.destroy()}}}function Lt(t){var e,n;return{c(){x(e=w("div"),"id",t.i),x(e,"class",n="cell "+t.cellClasses(t.fig)+"\r\n          "+(t.fig.possible&&!t.fig.frozen&&t.fig==t.enemy?"aimed":"")+"\r\n          "+(!t.fig.dream||t.fig.resolved||t.fig.frozen?"":"dream"))},m(t,n){p(t,e,n)},p(t,s){(t.$board||t.enemy)&&n!==(n="cell "+s.cellClasses(s.fig)+"\r\n          "+(s.fig.possible&&!s.fig.frozen&&s.fig==s.enemy?"aimed":"")+"\r\n          "+(!s.fig.dream||s.fig.resolved||s.fig.frozen?"":"dream"))&&x(e,"class",n)},d(t){t&&b(e)}}}function Dt(t){for(var e,n,s=[...t.$saves].sort(Qt),r=[],i=0;i<s.length;i+=1)r[i]=qt(mt(t,s,i));return{c(){e=w("div"),n=w("ul");for(var t=0;t<r.length;t+=1)r[t].c();x(e,"class","files")},m(t,s){p(t,e,s),g(e,n);for(var i=0;i<r.length;i+=1)r[i].m(n,null)},p(t,e){if(t.$saves||t.lang){s=[...e.$saves].sort(Qt);for(var i=0;i<s.length;i+=1){const o=mt(e,s,i);r[i]?r[i].p(t,o):(r[i]=qt(o),r[i].c(),r[i].m(n,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=s.length}},d(t){t&&b(e),y(r,t)}}}function It(t){var e,n,s="auto"==t.save[0]?"AUTO":"";return{c(){e=w("span"),n=$(s)},m(t,s){p(t,e,s),g(e,n)},p(t,e){t.$saves&&s!==(s="auto"==e.save[0]?"AUTO":"")&&A(n,s)},d(t){t&&b(e)}}}function Wt(t){var e,n,s;function r(...e){return t.click_handler_3(t,...e)}return{c(){e=w("button"),n=$("X"),x(e,"class","tooltip-bottom"),e.dataset.tooltip=ht.tip_erase,s=_(e,"click",r)},m(t,s){p(t,e,s),g(e,n)},p(e,n){t=n},d(t){t&&b(e),s()}}}function qt(t){var e,n,s,r,i,o,a="#NEW"==t.save[1]?"Save in a new slot":t.save[1];function l(t){return"auto"!=t.save[0]&&"#NEW"!=t.save[1]?Wt:It}var c=l(t),d=c(t);function u(...e){return t.click_handler_4(t,...e)}return{c(){e=w("li"),d.c(),n=k(),s=w("button"),r=$(a),i=k(),x(s,"class","save"),o=_(s,"click",u)},m(t,o){p(t,e,o),d.m(e,null),g(e,n),g(e,s),g(s,r),g(e,i)},p(s,i){c===(c=l(t=i))&&d?d.p(s,t):(d.d(1),(d=c(t))&&(d.c(),d.m(e,n))),s.$saves&&a!==(a="#NEW"==t.save[1]?"Save in a new slot":t.save[1])&&A(r,a)},d(t){t&&b(e),d.d(),o()}}}function Kt(e){var n,s,r,o,a,l,c,d,u,h,f,m,v,N,M,S,C,O,T,z,E,R,j,F,P,B,H,U,L,D,I,W,q,K,Y,J,Q,X,Z,V,G,tt,et,nt,st,rt,it,ot,at,lt,ct,dt,ut,ft,mt,gt,pt,vt,yt,wt,kt,_t,xt,At,Nt,Mt,St,Ct,Ot,Tt,zt,Et={board:ht.what,files:ht.what_files}[e.page],Ft=e.$debrief.score,Ut=e.$debrief.dreamsResolved,Lt=e.$debrief.turns,It=e.$debrief.challengeUrl,Wt=e.enemy&&e.enemy.battle&&e.enemy.battler&&$t(e);function qt(t){return"board"==t.page?jt:Rt}for(var Kt=qt(e),Jt=Kt(e),Qt="board"==e.page&&Pt(e),Xt=e.statsOrder,Zt=[],Vt=0;Vt<Xt.length;Vt+=1)Zt[Vt]=Bt(bt(e,Xt,Vt));var Gt="board"==e.page&&Ht(e),te="files"==e.page&&Dt(e);return{c(){Wt&&Wt.c(),n=k(),s=w("div"),r=w("div"),(o=w("button")).textContent="menu",a=k(),l=w("div"),(c=w("button")).textContent="Help",d=k(),(u=w("button")).textContent="Board",h=k(),(f=w("button")).textContent="Files",m=k(),v=w("div"),N=k(),Jt.c(),M=k(),S=w("div"),C=k(),O=w("div"),Qt&&Qt.c(),T=k(),z=w("div"),E=w("noscript"),R=k(),j=w("div"),F=k(),(P=w("button")).textContent="Ok, got it",H=k(),U=w("div"),L=w("div"),(D=w("h4")).textContent="Board clear",I=k(),W=w("big"),q=$("Score:\r\n      "),K=w("span"),Y=$(Ft),J=$("\r\n    =\r\n    "),Q=w("br"),X=k(),Z=w("br"),V=k(),G=$(Ut),tt=k(),et=w("span"),nt=$(" dream"),st=$("\r\n    cells * 100\r\n    ");for(var t=0;t<Zt.length;t+=1)Zt[t].c();rt=$("\r\n    - "),it=$(Lt),ot=$(" turns * 3"),at=k(),lt=w("br"),ct=k(),(dt=w("small")).innerHTML="\n\t\t\t    Challenge url - you can share it with someone who wants to try and beat your\n\t\t\t    record on this board:\n\t\t\t    <br> <br>",ut=k(),ft=w("u"),mt=w("a"),gt=$(It),vt=k(),yt=w("br"),wt=k(),kt=w("br"),_t=k(),xt=w("div"),(At=w("button")).textContent="Undo",Nt=k(),(Mt=w("button")).textContent="Edit board",Ct=k(),Ot=w("div"),Gt&&Gt.c(),Tt=k(),te&&te.c(),x(l,"class","dropdown"),x(r,"class","menu"),x(v,"class","spacer"),x(S,"class","spacer"),x(O,"class","turns"),x(s,"class","header"),x(z,"class",B="bottom panel "+(e.$what?"":"panel-hidden-ne")),x(K,"class",e.rainbow),x(et,"class",e.rainbow),x(mt,"href",pt=e.$debrief.challengeUrl),x(xt,"class","buttons-horizontal"),x(U,"class",St="center panel "+(e.$state.complete&&"board"==e.page?"":"panel-hidden")),x(Ot,"class","main"),zt=[_(c,"click",e.toggleWhat),_(u,"click",e.click_handler),_(f,"click",e.click_handler_1),_(P,"click",e.click_handler_2),_(At,"click",e.undo),_(Mt,"click",Yt)]},m(t,e){Wt&&Wt.m(t,e),p(t,n,e),p(t,s,e),g(s,r),g(r,o),g(r,a),g(r,l),g(l,c),g(l,d),g(l,u),g(l,h),g(l,f),g(s,m),g(s,v),g(s,N),Jt.m(s,null),g(s,M),g(s,S),g(s,C),g(s,O),Qt&&Qt.m(O,null),p(t,T,e),p(t,z,e),g(z,E),E.insertAdjacentHTML("beforebegin",Et),g(z,R),g(z,j),g(z,F),g(z,P),p(t,H,e),p(t,U,e),g(U,L),g(L,D),g(L,I),g(L,W),g(W,q),g(W,K),g(K,Y),g(L,J),g(L,Q),g(L,X),g(L,Z),g(L,V),g(L,G),g(L,tt),g(L,et),g(et,nt),g(L,st);for(var i=0;i<Zt.length;i+=1)Zt[i].m(L,null);g(L,rt),g(L,it),g(L,ot),g(U,at),g(U,lt),g(U,ct),g(U,dt),g(U,ut),g(U,ft),g(ft,mt),g(mt,gt),g(ft,vt),g(ft,yt),g(ft,wt),g(ft,kt),g(ft,_t),g(ft,xt),g(xt,At),g(xt,Nt),g(xt,Mt),p(t,Ct,e),p(t,Ot,e),Gt&&Gt.m(Ot,null),g(Ot,Tt),te&&te.m(Ot,null)},p(t,e){if(e.enemy&&e.enemy.battle&&e.enemy.battler?Wt?Wt.p(t,e):((Wt=$t(e)).c(),Wt.m(n.parentNode,n)):Wt&&(Wt.d(1),Wt=null),Kt===(Kt=qt(e))&&Jt?Jt.p(t,e):(Jt.d(1),(Jt=Kt(e))&&(Jt.c(),Jt.m(s,M))),"board"==e.page?Qt?Qt.p(t,e):((Qt=Pt(e)).c(),Qt.m(O,null)):Qt&&(Qt.d(1),Qt=null),t.page&&Et!==(Et={board:ht.what,files:ht.what_files}[e.page])&&(!function(t){for(;t.previousSibling;)t.parentNode.removeChild(t.previousSibling)}(E),E.insertAdjacentHTML("beforebegin",Et)),t.$what&&B!==(B="bottom panel "+(e.$what?"":"panel-hidden-ne"))&&x(z,"class",B),t.$debrief&&Ft!==(Ft=e.$debrief.score)&&A(Y,Ft),t.$debrief&&Ut!==(Ut=e.$debrief.dreamsResolved)&&A(G,Ut),t.fg||t.statsOrder||t.bigNum||t.$debrief){Xt=e.statsOrder;for(var r=0;r<Xt.length;r+=1){const n=bt(e,Xt,r);Zt[r]?Zt[r].p(t,n):(Zt[r]=Bt(n),Zt[r].c(),Zt[r].m(L,rt))}for(;r<Zt.length;r+=1)Zt[r].d(1);Zt.length=Xt.length}t.$debrief&&Lt!==(Lt=e.$debrief.turns)&&A(it,Lt),t.$debrief&&It!==(It=e.$debrief.challengeUrl)&&A(gt,It),t.$debrief&&pt!==(pt=e.$debrief.challengeUrl)&&x(mt,"href",pt),(t.$state||t.page)&&St!==(St="center panel "+(e.$state.complete&&"board"==e.page?"":"panel-hidden"))&&x(U,"class",St),"board"==e.page?Gt?Gt.p(t,e):((Gt=Ht(e)).c(),Gt.m(Ot,Tt)):Gt&&(Gt.d(1),Gt=null),"files"==e.page?te?te.p(t,e):((te=Dt(e)).c(),te.m(Ot,null)):te&&(te.d(1),te=null)},i:t,o:t,d(t){Wt&&Wt.d(t),t&&(b(n),b(s)),Jt.d(),Qt&&Qt.d(),t&&(b(T),b(z),b(H),b(U)),y(Zt,t),t&&(b(Ct),b(Ot)),Gt&&Gt.d(),te&&te.d(),i(zt)}}}function Yt(){}function Jt(t){window.location.search="?"+new URLSearchParams(t).toString()}function Qt(t,e){return Number(t[0].substr(5))<Number(e[0].substr(5))?-1:1}function Xt(t,e,n){let s,r,i,o,a,c,d,u,h;l(t,X,t=>{n("$game",s=t)}),l(t,V,t=>{n("$what",r=t)}),l(t,G,t=>{n("$abridgedAnalysis",i=t)}),l(t,Z,t=>{n("$state",o=t)}),l(t,J,t=>{n("$debrief",a=t)}),l(t,Y,t=>{n("$conf",c=t)}),l(t,Q,t=>{n("$board",d=t)}),l(t,tt,t=>{n("$saves",u=t)});let f,m="board",g=[0,0],p=s.colors,b={},v={};for(let t in p)b[t]="fg-"+p[t],n("fg",b),v[t]="bg-"+p[t];let y=navigator.userAgent.search("Chrome")>=0,w="rainbow"+(y?" rainbow-animation":""),$={};const k="str vit def spd".split(" ");Y.subscribe(t=>Object.assign($,t));let _,x,A=[];function N(){s.undo(),A.length=0,n("justResolved",A)}document.onmousemove=(t=>{g=[t.x,t.y];let e=Math.abs(t.movementX)+Math.abs(t.movementY);!function(){let t=s.figAt(f);f=null,!t||t.resolved?n("enemy",h=null):(t.updateBattler(),n("enemy",h=t))}(),e>4&&(x&&clearTimeout(x),n("moveTimeout",x=setTimeout(t=>{n("moveTimeout",x=null)},1e3)))});let M=" K M B t q Q s S o n d U D T Qt Qd Sd St O N v c".split(" ");function S(t){f=h=null,n("enemy",h),n("page",m=t),"files"==t&&st()}function O(){r=!r,V.set(r)}function T(t){console.log("del",t),s.erase(t),st()}function z(t){console.log("load",t),s.load(t),Jt(s.conf)}function E(t){s.save(t),st(),console.log("new",t)}return window.onkeydown=(t=>{switch(t.code){case"KeyS":return void E();case"KeyF":return void S("files"==m?"board":"files");case"KeyB":return void S("board");case"KeyH":return void O();case"KeyU":return void N()}}),{enemy:h,page:m,fg:b,rainbow:w,custom:$,statsOrder:k,justResolved:A,clickCell:function(t){0==t.button&&(t.shiftKey?s.logFigAt(t.target.id):function(t){if(!t)return;let e=t.color,r=[];for(let n of t.cells)r.push(`left:${n%s.width*20}px;top:${20*Math.floor(n/s.width)}px;background:${e}`);n("justResolved",A=A.length>20?r:A.concat(r))}(s.attackFigAt(t.target.id)))},hoverCell:function(t){f=t.target.id},unHoverCell:function(t){f=h=null,n("enemy",h)},analysis:_,analysisPosition:function(){let[t,e]=g,n=_?_.offsetWidth:400;return`left: ${t>window.innerWidth-n-50?t-n-50:t+100}px; top: ${Math.min(e,window.innerHeight-(_?_.offsetHeight:50)-50)}px`},moveTimeout:x,undo:N,bigNum:function(t){let e;for(e=0;Math.abs(t)>1e4&&e<M.length;e++)t/=1e3;return Math.round(t)+M[e]},open:S,playCustom:function(){Jt($)},toggleWhat:O,deleteSave:T,loadSave:z,newSave:E,cellClasses:function(t){let e=[t.dream&&!t.resolved?"bg-none":v[t.kind],t.resolved&&!t.dream?"resolved":""];return t.frozen?e.push("frozen"):e=e.concat([t.dream&&t.resolved&&y?"rainbow-animation":"",t.possible?"attackable":"",t.dream||t.possible||t.resolved&&t.reached?"":"darken"]),e=e.filter(t=>""!=t).join(" ")},Math:Math,$what:r,$abridgedAnalysis:i,$state:o,$debrief:a,$conf:c,$board:d,$saves:u,div_binding:function(t){C[t?"unshift":"push"](()=>{n("analysis",_=t)})},click_handler:function(t){return S("board")},click_handler_1:function(t){return S("files")},click_handler_2:function(t){const e=r=!1;return V.set(r),e},input0_input_handler:function(){$.seed=this.value,n("custom",$)},input1_input_handler:function(){$.width=this.value,n("custom",$)},input2_input_handler:function(){$.height=this.value,n("custom",$)},click_handler_3:function({save:t},e){return T(t[0])},click_handler_4:function({save:t},e){return"#NEW"==t[1]?E(t[0]):z(t[0])}}}class Zt extends L{constructor(t){super(),U(this,t,Xt,Kt,a,[])}}return window.onload=function(){app=new Zt({target:document.body,props:{game:ut.create()}})},app}();

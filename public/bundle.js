var app=function(){"use strict";function t(){}const e=t=>t;function n(t,e){for(const n in e)t[n]=e[n];return t}function s(t){return t()}function i(){return Object.create(null)}function r(t){t.forEach(s)}function a(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(t,e,n){const s=e.subscribe(n);t.$$.on_destroy.push(s.unsubscribe?()=>s.unsubscribe():s)}let u="undefined"!=typeof window?()=>window.performance.now():()=>Date.now(),c=t=>requestAnimationFrame(t);const h=new Set;let d,f=!1;function m(){h.forEach(t=>{t[0](u())||(h.delete(t),t[1]())}),(f=h.size>0)&&c(m)}function p(t,e){t.appendChild(e)}function g(t,e,n){t.insertBefore(e,n||null)}function b(t){t.parentNode.removeChild(t)}function v(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function y(t){return document.createElement(t)}function w(t){return document.createTextNode(t)}function $(){return w(" ")}function k(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function x(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}function _(t,e){e=""+e,t.data!==e&&(t.data=e)}function N(t,e,n){t.style.setProperty(e,n)}function S(t){d=t}const C=[],M=[],A=[],T=[],O=Promise.resolve();let E=!1;function B(t){A.push(t)}function j(){const t=new Set;do{for(;C.length;){const t=C.shift();S(t),H(t.$$)}for(;M.length;)M.pop()();for(let e=0;e<A.length;e+=1){const n=A[e];t.has(n)||(n(),t.add(n))}A.length=0}while(C.length);for(;T.length;)T.pop()();E=!1}function H(t){t.fragment&&(t.update(t.dirty),r(t.before_update),t.fragment.p(t.dirty,t.ctx),t.dirty=null,t.after_update.forEach(B))}const W=new Set;const I="undefined"!=typeof window?window:global;function P(t,e){t.$$.dirty||(C.push(t),E||(E=!0,O.then(j)),t.$$.dirty=i()),t.$$.dirty[e]=!0}function D(e,n,o,l,u,c){const h=d;S(e);const f=n.props||{},m=e.$$={fragment:null,ctx:null,props:c,update:t,not_equal:u,bound:i(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:[]),callbacks:i(),dirty:null};let p=!1;var g,b,v;m.ctx=o?o(e,f,(t,n)=>{m.ctx&&u(m.ctx[t],m.ctx[t]=n)&&(m.bound[t]&&m.bound[t](n),p&&P(e,t))}):f,m.update(),p=!0,r(m.before_update),m.fragment=l(m.ctx),n.target&&(n.hydrate?m.fragment.l((v=n.target,Array.from(v.childNodes))):m.fragment.c(),n.intro&&((g=e.$$.fragment)&&g.i&&(W.delete(g),g.i(b))),function(t,e,n){const{fragment:i,on_mount:o,on_destroy:l,after_update:u}=t.$$;i.m(e,n),B(()=>{const e=o.map(s).filter(a);l?l.push(...e):r(e),t.$$.on_mount=[]}),u.forEach(B)}(e,n.target,n.anchor),j()),S(h)}class F{$destroy(){var e,n;n=1,(e=this).$$.fragment&&(r(e.$$.on_destroy),e.$$.fragment.d(n),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={}),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function K(e,n=t){let s;const i=[];function r(t){if(o(e,t)){if(e=t,!s)return;i.forEach(t=>t[1]()),i.forEach(t=>t[0](e))}}return{set:r,update:function(t){r(t(e))},subscribe:function(a,o=t){const l=[a,o];return i.push(l),1===i.length&&(s=n(r)||t),a(e),()=>{const t=i.indexOf(l);-1!==t&&i.splice(t,1),0===i.length&&(s(),s=null)}}}}function U(t){return"[object Date]"===Object.prototype.toString.call(t)}function L(t,e){if(t===e||t!=t)return()=>t;const n=typeof t;if(n!==typeof e||Array.isArray(t)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(t)){const n=e.map((e,n)=>L(t[n],e));return t=>n.map(e=>e(t))}if("object"===n){if(!t||!e)throw new Error("Object cannot be null");if(U(t)&&U(e)){t=t.getTime();const n=(e=e.getTime())-t;return e=>new Date(t+e*n)}const n=Object.keys(e),s={};return n.forEach(n=>{s[n]=L(t[n],e[n])}),t=>{const e={};return n.forEach(n=>{e[n]=s[n](t)}),e}}if("number"===n){const n=e-t;return e=>t+e*n}throw new Error(`Cannot interpolate ${n} values`)}function z(t,s={}){const i=K(t);let r,a=t;function o(o,l){a=o;let d=r,p=!1,{delay:g=0,duration:b=400,easing:v=e,interpolate:y=L}=n(n({},s),l);const w=u()+g;let $;return(r=function(t){let e;return f||(f=!0,c(m)),{promise:new Promise(n=>{h.add(e=[t,n])}),abort(){h.delete(e)}}}(e=>{if(e<w)return!0;p||($=y(t,o),"function"==typeof b&&(b=b(t,o)),p=!0),d&&(d.abort(),d=null);const n=e-w;return n>b?(i.set(t=o),!1):(i.set(t=$(v(n/b))),!0)})).promise}return{set:o,update:(e,n)=>o(e(a,t),n),subscribe:i.subscribe}}let Y={duration:100,easing:t=>t};const q=K(0),J=K(null),Q=K(!0);Q.set("no"!=localStorage.what),Q.subscribe(t=>localStorage.setItem("what",t?"yes":"no"));const X=z(0,Y),G=z(0,Y),R=z(0,Y),V=z(0,Y),Z=z(0,Y),tt=K([]);let et="game ",nt=et.length;function st(){let t=[],e=0;for(let n in localStorage)if("auto"==n||n.substr(0,nt)==et){let s=JSON.parse(localStorage[n]),i=Number(n.substr(nt));i>=e&&(e=i+1);let r="?";try{r=`t${s.turns.length} ${s.conf.width}x${s.conf.height} #${s.conf.seed} ${s.date.toLocaleString()}`}catch(t){console.error(t)}"auto"==n?t.unshift([n,r]):t.push([n,r])}t.push(["game "+e,"#NEW"]),tt.set(t)}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var it,rt=(function(t,e){t.exports=function(){var t=624,e=397,n=function(e){void 0===e&&(e=(new Date).getTime()),this.mt=new Array(t),this.mti=625,this.seed(e)};n.prototype.seed=function(e){var n;for(this.mt[0]=e>>>0,this.mti=1;this.mti<t;this.mti++)n=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(1812433253*((4294901760&n)>>>16)<<16)+1812433253*(65535&n)+this.mti,this.mt[this.mti]>>>=0},n.prototype.seedArray=function(e){var n,s=1,i=0,r=t>e.length?t:e.length;for(this.seed(19650218);r>0;r--)n=this.mt[s-1]^this.mt[s-1]>>>30,this.mt[s]=(this.mt[s]^(1664525*((4294901760&n)>>>16)<<16)+1664525*(65535&n))+e[i]+i,this.mt[s]>>>=0,i++,++s>=t&&(this.mt[0]=this.mt[623],s=1),i>=e.length&&(i=0);for(r=623;r;r--)n=this.mt[s-1]^this.mt[s-1]>>>30,this.mt[s]=(this.mt[s]^(1566083941*((4294901760&n)>>>16)<<16)+1566083941*(65535&n))-s,this.mt[s]>>>=0,++s>=t&&(this.mt[0]=this.mt[623],s=1);this.mt[0]=2147483648},n.prototype.int=function(){var n,s,i=new Array(0,2567483615);if(this.mti>=t){for(625===this.mti&&this.seed(5489),s=0;s<227;s++)n=2147483648&this.mt[s]|2147483647&this.mt[s+1],this.mt[s]=this.mt[s+e]^n>>>1^i[1&n];for(;s<623;s++)n=2147483648&this.mt[s]|2147483647&this.mt[s+1],this.mt[s]=this.mt[s+(e-t)]^n>>>1^i[1&n];n=2147483648&this.mt[623]|2147483647&this.mt[0],this.mt[623]=this.mt[396]^n>>>1^i[1&n],this.mti=0}return n=this.mt[this.mti++],n^=n>>>11,n^=n<<7&2636928640,n^=n<<15&4022730752,(n^=n>>>18)>>>0},n.prototype.int31=function(){return this.int()>>>1},n.prototype.real=function(){return this.int()*(1/4294967295)},n.prototype.realx=function(){return(this.int()+.5)*(1/4294967296)},n.prototype.rnd=function(){return this.int()*(1/4294967296)},n.prototype.random=n.prototype.rnd,n.prototype.rndHiRes=function(){var t=this.int()>>>5,e=this.int()>>>6;return(67108864*t+e)*(1/9007199254740992)};var s=new n;return n.random=function(){return s.rnd()},n}()}(it={exports:{}},it.exports),it.exports);class at{constructor(t,e){this.id=t,this.twister=new rt,e&&Object.assign(this,e)}interval(){return 1e4/this.spd}rni(){return this.twister.int()}seed(t){this.twister.seed(2*Math.abs(t)+this.id)}get isProto(){return-1==this.id}}at.statsOrder="str vit def spd".split(" "),at.statsBase={str:10,vit:30,def:10,spd:10};class ot{constructor(t){this.bats=t,this.time=0,this.log=[],this.hp=[];for(let e of t)e.hp=e.vit,e.nextAttack=e.interval();t[0].seed(t[1].id),t[1].seed(t[0].id);let e=30;for(;!this.over()&&e-- >0;){let e=Math.min(...t.map(t=>t.nextAttack));this.time=e;for(let e of t)if(e.nextAttack<=this.time&&!(e.hp<=0)){let n=t[0]==e?t[1]:t[0];this.log.push(this.attack(e,n))}}this.hp=this.bats.map(t=>t.hp),t[0].hp<=0?this.outcome="lose":t[1].hp<=0?this.outcome="win":this.outcome="draw"}attack(t,e){t.nextAttack=this.time+t.interval();let n=0,s=t.str<=1e6?t.rni()%(2*t.str):t.rni()%2e6*t.str/1e6;return(n=Math.max(0,s-e.def))>0&&(e.hp-=n),{a:t,d:e,damage:n,hp:e.hp}}over(){return this.log.length>=20||!this.bats.every(t=>t.hp>0)}}class lt{constructor(t,e,n){this.game=t,this.kind=e,this.id=n,this.cells=[],this.neighbors=[],this.dead=!1,this.reached=!1}addNeighbor(t){t&&!this.neighbors.includes(t)&&(this.neighbors.push(t),t.neighbors.push(this))}reach(){this.reached||(this.reached=!0,"none"==this.kind&&this.die())}die(){if(!this.dead){this.battler||this.updateBattler(),this.dead=!0;for(let t of this.neighbors)t.reach();this.loot()}}updateBattler(){if(this.dead||"none"==this.kind)return this.battler=null,this;let t={};for(let e in at.statsBase)t[e]=0;t[this.kind]=4*this.cells.length;for(let e of this.neighbors)e.dead||(t[e.kind]+=e.cells.length);this.battler||(this.battler=new at(this.id));for(let e in at.statsBase)this.battler[e]=Math.floor(at.statsBase[e]*(10+2*t[e])*Math.pow(10,1+this.depth/20)/100);return this.battle=new ot([this.game.prota,this.battler]),this}get attackable(){return this.reached&&!this.dead&&this.battle&&"win"==this.battle.outcome}get winnable(){return this.attackable&&"win"==this.battle.outcome}loot(){let t=this.kind;"none"!=t&&(this.game.prota[t]+=Math.floor(this.battler[t]/10),this.game.cash+=this.cash)}get cash(){return this.cells.length*(this.depth+10)}get xp(){let t=this.kind;return[t,Math.floor(this.battler[t]/10)]}}class ut{constructor(t,e){this.twister=new rt,this.board=[],this.beasts=[],this.persist=null,t&&(this.conf=t),e&&this.loadOrGenerate(e),J.set(this)}persistIn(t){return this.persist=t,this}loadOrGenerate(t){return this.persist=t,this.load(t)||(this.generate(),this.play()),this}config(t){return this.conf=t,this}load(t){if(!t)return;let e=localStorage.getItem(t);return!(!e||"undefined"==e)&&(this.deserialize(JSON.parse(e)),!0)}save(t){t||(t=function(){let t=0;for(let e in localStorage)if(e.substr(0,nt)==et){let n=Number(e.substr(nt));n>=t&&(t=n+1)}return et+t}()),console.log("saving to",t),localStorage.setItem(t,JSON.stringify(this.serialized()))}remove(t){localStorage.removeItem(t)}get savedFields(){return"conf turns cash".split(" ")}serialized(){let t={date:new Date};for(let e of this.savedFields)t[e]=this[e];return t}get cellsNumber(){return this.width*this.height}get width(){return this.conf.width}get height(){return this.conf.height}deserialize(t){console.log(t);for(let e in t)this[e]=t[e];this.generate(),this.play(t.turns)}generate(){this.turns=[],this.beasts=[],this.twister.seed(this.conf.seed),this.rni=this.twister.int.bind(this.twister),this.deltas=[-1,1,-this.width,+this.width];let t=[...Array(this.cellsNumber)].map(t=>(function(t,e){let n=e()%t.reduce((t,e)=>t+e)-t[0],s=0;for(;n>=0;)n-=t[++s];return s})([1,1,1,1,1],this.rni));this.board=t.map(t=>null);for(let e in t)this.populate(t,Number(e))}populate(t,e){if(this.board[e])return;let n=t[e],s=[e],i=new lt(this,["str","vit","def","spd","none"][n],this.beasts.length);for(this.beasts.push(i);s.length>0;){let e=s.pop();this.board[e]=i,i.cells.push(e);for(let r of this.deltas){let a=e+r;1==Math.abs(r)&&Math.floor(e/this.width)!=Math.floor(a/this.width)||(this.board[a]?i.addNeighbor(this.board[a]):t[a]==n&&s.push(a))}}for(let t of this.beasts){let e=t.cells.map(t=>Math.floor(t/this.width));t.depth=Math.round(e.reduce((t,e)=>t+e)/t.cells.length)}}play(t=[]){this.turns=t,this.cash=0,this.prota=new at(-1,{str:20,vit:50,agi:10,def:10,spd:30,int:10});for(let t of this.beasts)t.reached=!1,t.dead=!1,t.battle=null;for(let t=0;t<this.width;t++)this.board[t].reach();for(let e of t)this.beasts[e]&&this.beasts[e].die();this.updateStore()}attackBeast(t){let e=this.beasts[t];e&&e.winnable&&(e.die(),this.turns.push(t),this.updateStore(),this.save(this.persist))}updateBattles(){for(let t of this.beasts)t.reached&&!t.dead&&t.updateBattler()}undo(){this.turns.length>0&&this.play(this.turns.slice(0,-1))}reset(){this.play()}logBeast(t){let e=this.beasts[t];e.updateBattler(),console.log(e)}beast(t){return this.beasts[t]}updateStore(){this.updateBattles(),J.set(this),q.set(this.turns.length),X.set(this.cash,null),G.set(this.prota.str,null),R.set(this.prota.vit,null),V.set(this.prota.def,null),Z.set(this.prota.spd,null)}}let ct={what:"\n<ol type=\"I\">\n<li>Objective is to reach the bottom of the board and get as much money as possible until you run out of turns.\n<li>Each colored shape is a monster.\n<li>If the monster is highlighted, it means that it's in your reach and you are powerful enough to win. Click to do it.\n<li>You will expend one turn on fight and will be rewarded with some of enemy's stats and some money. \n<li>You can see enemy stats, battle projection and expected loot simply by mouse-overing it.\n<li>Combat is automatic. \n<li>VIT is how many HP you start with.\nYou attack as often as your SPD is, deal damage to enemy HP at random between 0% and 200% of STR, minus target's DEF.\n<li>Enemy does the same. \n<li>There is a draw if no one loses after 20 attacks are made. It's equivalent to your defeat in most cases.\n</ol>\n  ",what_files:'\n<ol type="I">\n  <li>After each your move game is saved to the AUTO slot. \n  <li>You can save in new slot, load any save or delete them with X.\n</ol>  \n  '};const{Object:ht}=I;function dt(t,e,n){const s=ht.create(t);return s.save=e[n],s}function ft(t,e,n){const s=ht.create(t);return s.beast=e[n],s}function mt(t,e,n){const s=ht.create(t);return s.move=e[n],s}function pt(t,e,n){const s=ht.create(t);return s.field=e[n],s.i=n,s}function gt(t){for(var e,n,s,i,r,a,o,l,u=at.statsOrder,c=[],h=0;h<u.length;h+=1)c[h]=bt(pt(t,u,h));var d=t.enemy.battle.log,f=[];for(h=0;h<d.length;h+=1)f[h]=wt(mt(t,d,h));function m(t){return"win"==t.enemy.battle.outcome?kt:$t}var w=m(t),k=w(t);return{c(){e=y("div"),n=y("div");for(var u=0;u<c.length;u+=1)c[u].c();s=$(),i=y("div");for(u=0;u<f.length;u+=1)f[u].c();r=$(),a=y("div"),k.c(),x(n,"class","enemy"),x(i,"class","combat-log"),x(a,"class",o="battle-"+t.enemy.battle.outcome+" battle-outcome"),x(e,"class",l="analysis "+(t.enemy&&t.enemy.battle&&!t.moveTimeout?"shown":""))},m(o,l){g(o,e,l),p(e,n);for(var u=0;u<c.length;u+=1)c[u].m(n,null);p(e,s),p(e,i);for(u=0;u<f.length;u+=1)f[u].m(i,null);p(e,r),p(e,a),k.m(a,null),t.div3_binding(e)},p(t,s){if(t.Battler||t.bigNum||t.enemy){u=at.statsOrder;for(var r=0;r<u.length;r+=1){const e=pt(s,u,r);c[r]?c[r].p(t,e):(c[r]=bt(e),c[r].c(),c[r].m(n,null))}for(;r<c.length;r+=1)c[r].d(1);c.length=u.length}if(t.enemy||t.bigNum){d=s.enemy.battle.log;for(r=0;r<d.length;r+=1){const e=mt(s,d,r);f[r]?f[r].p(t,e):(f[r]=wt(e),f[r].c(),f[r].m(i,null))}for(;r<f.length;r+=1)f[r].d(1);f.length=d.length}w===(w=m(s))&&k?k.p(t,s):(k.d(1),(k=w(s))&&(k.c(),k.m(a,null))),t.enemy&&o!==(o="battle-"+s.enemy.battle.outcome+" battle-outcome")&&x(a,"class",o),(t.enemy||t.moveTimeout)&&l!==(l="analysis "+(s.enemy&&s.enemy.battle&&!s.moveTimeout?"shown":""))&&x(e,"class",l)},d(n){n&&b(e),v(c,n),v(f,n),k.d(),t.div3_binding(null)}}}function bt(t){var e,n,s,i,r,a=0==t.i?"":"&nbsp;",o=t.bigNum(t.enemy.battler[t.field]);return{c(){e=y("noscript"),n=y("noscript"),s=$(),i=y("span"),r=w(o),x(i,"class","fg-"+t.field)},m(t,o){g(t,e,o),e.insertAdjacentHTML("afterend",a),g(t,n,o),g(t,s,o),g(t,i,o),p(i,r)},p(t,e){t.enemy&&o!==(o=e.bigNum(e.enemy.battler[e.field]))&&_(r,o)},d(t){t&&(!function(t,e){for(;t.nextSibling&&t.nextSibling!==e;)t.parentNode.removeChild(t.nextSibling)}(e,n),b(e),b(n),b(s),b(i))}}}function vt(e){var n;return{c(){n=w("=")},m(t,e){g(t,n,e)},p:t,d(t){t&&b(n)}}}function yt(t){var e,n=t.bigNum(t.move.hp);return{c(){e=w(n)},m(t,n){g(t,e,n)},p(t,s){t.enemy&&n!==(n=s.bigNum(s.move.hp))&&_(e,n)},d(t){t&&b(e)}}}function wt(t){var e,n,s,i;function r(t){return t.move.damage>0?yt:vt}var a=r(t),o=a(t);return{c(){e=y("span"),o.c(),s=$(),i=y("span"),x(e,"class",n=t.move.a.isProto?"attacking":"defending")},m(t,n){g(t,e,n),o.m(e,null),g(t,s,n),g(t,i,n)},p(t,s){a===(a=r(s))&&o?o.p(t,s):(o.d(1),(o=a(s))&&(o.c(),o.m(e,null))),t.enemy&&n!==(n=s.move.a.isProto?"attacking":"defending")&&x(e,"class",n)},d(t){t&&b(e),o.d(),t&&(b(s),b(i))}}}function $t(t){var e,n=t.enemy.battle.outcome.toUpperCase();return{c(){e=w(n)},m(t,n){g(t,e,n)},p(t,s){t.enemy&&n!==(n=s.enemy.battle.outcome.toUpperCase())&&_(e,n)},d(t){t&&b(e)}}}function kt(t){var e,n,s,i,r,a=t.bigNum(t.enemy.xp[1]),o=t.enemy.cash;return{c(){e=y("span"),n=w(a),i=$(),r=w(o),x(e,"class",s="fg-"+t.enemy.xp[0])},m(t,s){g(t,e,s),p(e,n),g(t,i,s),g(t,r,s)},p(t,i){t.enemy&&a!==(a=i.bigNum(i.enemy.xp[1]))&&_(n,a),t.enemy&&s!==(s="fg-"+i.enemy.xp[0])&&x(e,"class",s),t.enemy&&o!==(o=i.enemy.cash)&&_(r,o)},d(t){t&&(b(e),b(i),b(r))}}}function xt(t){var e,n;return{c(){e=y("div"),n=w(t.page),x(e,"class","page-title")},m(t,s){g(t,e,s),p(e,n)},p(t,e){t.page&&_(n,e.page)},d(t){t&&b(e)}}}function _t(t){var e,n,s,i,r,a,o,l,u,c,h,d,f,m,v,N,S,C,M,A,T,O,E,B,j,H=t.bigNum(t.$str),W=t.bigNum(t.$vit),I=t.bigNum(t.$def),P=t.bigNum(t.$spd);return{c(){(e=y("button")).textContent="undo",n=$(),s=y("div"),(i=y("span")).textContent="str",r=$(),a=y("span"),o=w(H),l=w("\r\n       \r\n      "),(u=y("span")).textContent="vit",c=$(),h=y("span"),d=w(W),f=w("\r\n       \r\n      "),(m=y("span")).textContent="def",v=$(),N=y("span"),S=w(I),C=w("\r\n       \r\n      "),(M=y("span")).textContent="spd",A=$(),T=y("span"),O=w(P),E=$(),(B=y("button")).textContent="ability",x(e,"class","hotkey"),x(i,"class","field-name"),x(a,"class","fg-str"),x(u,"class","field-name"),x(h,"class","fg-vit"),x(m,"class","field-name"),x(N,"class","fg-def"),x(M,"class","field-name"),x(T,"class","fg-spd"),x(s,"class","prota"),x(B,"class","hotkey wip"),j=k(e,"click",t.undo)},m(t,b){g(t,e,b),g(t,n,b),g(t,s,b),p(s,i),p(s,r),p(s,a),p(a,o),p(s,l),p(s,u),p(s,c),p(s,h),p(h,d),p(s,f),p(s,m),p(s,v),p(s,N),p(N,S),p(s,C),p(s,M),p(s,A),p(s,T),p(T,O),g(t,E,b),g(t,B,b)},p(t,e){t.$str&&H!==(H=e.bigNum(e.$str))&&_(o,H),t.$vit&&W!==(W=e.bigNum(e.$vit))&&_(d,W),t.$def&&I!==(I=e.bigNum(e.$def))&&_(S,I),t.$spd&&P!==(P=e.bigNum(e.$spd))&&_(O,P)},d(t){t&&(b(e),b(n),b(s),b(E),b(B)),j()}}}function Nt(t){var e,n,s,i,r,a,o,l,u,c=t.Math.round(t.$cash);return{c(){(e=y("span")).textContent="turns",n=$(),s=y("span"),i=w(t.$turns),r=$(),(a=y("span")).textContent="$",o=$(),l=y("span"),u=w(c),x(e,"class","field-name"),x(a,"class","field-name")},m(t,c){g(t,e,c),g(t,n,c),g(t,s,c),p(s,i),g(t,r,c),g(t,a,c),g(t,o,c),g(t,l,c),p(l,u)},p(t,e){t.$turns&&_(i,e.$turns),t.$cash&&c!==(c=e.Math.round(e.$cash))&&_(u,c)},d(t){t&&(b(e),b(n),b(s),b(r),b(a),b(o),b(l))}}}function St(t){var e,n,s,i,r,a,o,l={board:ct.what,files:ct.what_files}[t.page];return{c(){e=y("div"),n=y("noscript"),s=$(),i=y("div"),r=$(),(a=y("button")).textContent="Ok, got it",x(e,"class","what"),o=k(a,"click",t.click_handler_2)},m(t,o){g(t,e,o),p(e,n),n.insertAdjacentHTML("beforebegin",l),p(e,s),p(e,i),p(e,r),p(e,a)},p(t,e){t.page&&l!==(l={board:ct.what,files:ct.what_files}[e.page])&&(!function(t){for(;t.previousSibling;)t.parentNode.removeChild(t.previousSibling)}(n),n.insertAdjacentHTML("beforebegin",l))},d(t){t&&b(e),o()}}}function Ct(t){for(var e,n,s,i,a,o,l,u,c,h,d,f,m=t.$game.board,_=[],S=0;S<m.length;S+=1)_[S]=Mt(ft(t,m,S));return{c(){e=y("div");for(var r=0;r<_.length;r+=1)_[r].c();n=$(),s=y("div"),i=w("Seed\r\n      "),a=y("input"),o=w("\r\n       Width\r\n      "),l=y("input"),u=w("\r\n       Height\r\n      "),c=y("input"),h=w("\r\n       \r\n      "),(d=y("button")).textContent="play",x(e,"class","board-table"),N(e,"width",20*t.$game.width+"px"),x(s,"class","board-conf"),f=[k(e,"mousemove",t.hoverCell),k(e,"mousedown",t.clickCell),k(e,"mouseleave",t.unHoverCell),k(a,"input",t.input0_input_handler),k(l,"input",t.input1_input_handler),k(c,"input",t.input2_input_handler),k(d,"click",t.playFromConf)]},m(r,f){g(r,e,f);for(var m=0;m<_.length;m+=1)_[m].m(e,null);g(r,n,f),g(r,s,f),p(s,i),p(s,a),a.value=t.conf.seed,p(s,o),p(s,l),l.value=t.conf.width,p(s,u),p(s,c),c.value=t.conf.height,p(s,h),p(s,d)},p(t,n){if(t.$game||t.enemy){m=n.$game.board;for(var s=0;s<m.length;s+=1){const i=ft(n,m,s);_[s]?_[s].p(t,i):(_[s]=Mt(i),_[s].c(),_[s].m(e,null))}for(;s<_.length;s+=1)_[s].d(1);_.length=m.length}t.$game&&N(e,"width",20*n.$game.width+"px"),t.conf&&a.value!==n.conf.seed&&(a.value=n.conf.seed),t.conf&&l.value!==n.conf.width&&(l.value=n.conf.width),t.conf&&c.value!==n.conf.height&&(c.value=n.conf.height)},d(t){t&&b(e),v(_,t),t&&(b(n),b(s)),r(f)}}}function Mt(t){var e,n,s;return{c(){x(e=y("div"),"id",n=t.beast.id),x(e,"class",s="cell bg-"+t.beast.kind+"\r\n          "+(t.beast.attackable&&t.beast==t.enemy?"aimed":"")+"\r\n          "+(t.beast.dead?"dead":"")+"\r\n          "+(t.beast.attackable?"attackable":"")+"\r\n          "+(t.beast.winnable||t.beast.dead&&t.beast.reached?"lightup":"")+"\r\n          ")},m(t,n){g(t,e,n)},p(t,i){t.$game&&n!==(n=i.beast.id)&&x(e,"id",n),(t.$game||t.enemy)&&s!==(s="cell bg-"+i.beast.kind+"\r\n          "+(i.beast.attackable&&i.beast==i.enemy?"aimed":"")+"\r\n          "+(i.beast.dead?"dead":"")+"\r\n          "+(i.beast.attackable?"attackable":"")+"\r\n          "+(i.beast.winnable||i.beast.dead&&i.beast.reached?"lightup":"")+"\r\n          ")&&x(e,"class",s)},d(t){t&&b(e)}}}function At(t){for(var e,n,s=[...t.$games].sort(jt),i=[],r=0;r<s.length;r+=1)i[r]=Et(dt(t,s,r));return{c(){e=y("div"),n=y("ul");for(var t=0;t<i.length;t+=1)i[t].c();x(e,"class","files")},m(t,s){g(t,e,s),p(e,n);for(var r=0;r<i.length;r+=1)i[r].m(n,null)},p(t,e){if(t.$games){s=[...e.$games].sort(jt);for(var r=0;r<s.length;r+=1){const a=dt(e,s,r);i[r]?i[r].p(t,a):(i[r]=Et(a),i[r].c(),i[r].m(n,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=s.length}},d(t){t&&b(e),v(i,t)}}}function Tt(t){var e,n,s="auto"==t.save[0]?"AUTO":"";return{c(){e=y("span"),n=w(s)},m(t,s){g(t,e,s),p(e,n)},p(t,e){t.$games&&s!==(s="auto"==e.save[0]?"AUTO":"")&&_(n,s)},d(t){t&&b(e)}}}function Ot(t){var e,n;function s(...e){return t.click_handler_3(t,...e)}return{c(){(e=y("button")).textContent="X",n=k(e,"click",s)},m(t,n){g(t,e,n)},p(e,n){t=n},d(t){t&&b(e),n()}}}function Et(t){var e,n,s,i,r,a,o="#NEW"==t.save[1]?"Save in a new slot":t.save[1];function l(t){return"auto"!=t.save[0]&&"#NEW"!=t.save[1]?Ot:Tt}var u=l(t),c=u(t);function h(...e){return t.click_handler_4(t,...e)}return{c(){e=y("li"),c.c(),n=$(),s=y("button"),i=w(o),r=$(),x(s,"class","save"),a=k(s,"click",h)},m(t,a){g(t,e,a),c.m(e,null),p(e,n),p(e,s),p(s,i),p(e,r)},p(s,r){u===(u=l(t=r))&&c?c.p(s,t):(c.d(1),(c=u(t))&&(c.c(),c.m(e,n))),s.$games&&o!==(o="#NEW"==t.save[1]?"Save in a new slot":t.save[1])&&_(i,o)},d(t){t&&b(e),c.d(),a()}}}function Bt(e){var n,s,i,a,o,l,u,c,h,d,f,m,v,w,_,N,S,C,M,A,T,O,E,B,j,H=e.enemy&&e.enemy.battle&&e.enemy.battler&&gt(e);function W(t){return"board"==t.page?_t:xt}var I=W(e),P=I(e),D="board"==e.page&&Nt(e),F=e.$what&&St(e),K="board"==e.page&&Ct(e),U="files"==e.page&&At(e);return{c(){H&&H.c(),n=$(),s=y("div"),i=y("div"),(a=y("button")).textContent="menu",o=$(),l=y("div"),(u=y("button")).textContent="What",c=$(),(h=y("button")).textContent="Board",d=$(),(f=y("button")).textContent="Campaign",m=$(),(v=y("button")).textContent="Files",w=$(),_=y("div"),N=$(),P.c(),S=$(),C=y("div"),M=$(),A=y("div"),D&&D.c(),T=$(),F&&F.c(),O=$(),E=y("div"),K&&K.c(),B=$(),U&&U.c(),x(f,"class","wip"),x(l,"class","dropdown"),x(i,"class","menu"),x(_,"class","spacer"),x(C,"class","spacer"),x(A,"class","turns"),x(s,"class","header"),x(E,"class","main"),j=[k(u,"click",e.toggleWhat),k(h,"click",e.click_handler),k(v,"click",e.click_handler_1)]},m(t,e){H&&H.m(t,e),g(t,n,e),g(t,s,e),p(s,i),p(i,a),p(i,o),p(i,l),p(l,u),p(l,c),p(l,h),p(l,d),p(l,f),p(l,m),p(l,v),p(s,w),p(s,_),p(s,N),P.m(s,null),p(s,S),p(s,C),p(s,M),p(s,A),D&&D.m(A,null),g(t,T,e),F&&F.m(t,e),g(t,O,e),g(t,E,e),K&&K.m(E,null),p(E,B),U&&U.m(E,null)},p(t,e){e.enemy&&e.enemy.battle&&e.enemy.battler?H?H.p(t,e):((H=gt(e)).c(),H.m(n.parentNode,n)):H&&(H.d(1),H=null),I===(I=W(e))&&P?P.p(t,e):(P.d(1),(P=I(e))&&(P.c(),P.m(s,S))),"board"==e.page?D?D.p(t,e):((D=Nt(e)).c(),D.m(A,null)):D&&(D.d(1),D=null),e.$what?F?F.p(t,e):((F=St(e)).c(),F.m(O.parentNode,O)):F&&(F.d(1),F=null),"board"==e.page?K?K.p(t,e):((K=Ct(e)).c(),K.m(E,B)):K&&(K.d(1),K=null),"files"==e.page?U?U.p(t,e):((U=At(e)).c(),U.m(E,null)):U&&(U.d(1),U=null)},i:t,o:t,d(t){H&&H.d(t),t&&(b(n),b(s)),P.d(),D&&D.d(),t&&b(T),F&&F.d(t),t&&(b(O),b(E)),K&&K.d(),U&&U.d(),r(j)}}}function jt(t,e){return Number(t[0].substr(5))<Number(e[0].substr(5))?-1:1}function Ht(t,e,n){let s,i,r,a,o,u,c,h,d,f,m;l(t,J,t=>{n("$game",s=t)}),l(t,Q,t=>{n("$what",i=t)}),l(t,G,t=>{n("$str",r=t)}),l(t,R,t=>{n("$vit",a=t)}),l(t,V,t=>{n("$def",o=t)}),l(t,Z,t=>{n("$spd",u=t)}),l(t,q,t=>{n("$turns",c=t)}),l(t,X,t=>{n("$cash",h=t)}),l(t,tt,t=>{n("$games",d=t)});let p,g="board",b=Object.assign({},s.conf);function v(t,e){m&&(t=t>window.innerWidth-380?t-350:t+100,e=Math.min(e,window.innerHeight-m.offsetHeight-50),m.style.left=t+"px",n("analysis",m),m.style.top=e+"px",n("analysis",m))}function y(){s.undo()}document.onmousemove=(t=>{Math.abs(t.movementX)+Math.abs(t.movementY)<9?v(t.x,t.y):(p&&clearTimeout(p),n("moveTimeout",p=setTimeout(e=>{v(t.x,t.y),n("moveTimeout",p=null)},1)))});let w=" K M B t q Q s S o n d U D T Qt Qd Sd St O N v c".split(" ");function $(t){n("enemy",f=null),n("page",g=t),"files"==t&&st()}function k(){i=!i,Q.set(i)}function x(t){console.log("del",t),s.remove(t),st()}function _(t){console.log("load",t),s.load(t),$("board")}function N(t){s.save(t),st(),console.log("new",t)}return console.log(w.join(" ")),window.onkeydown=(t=>{switch(t.code){case"KeyS":return void N();case"KeyF":return void $("files"==g?"board":"files");case"KeyB":return void $("board");case"KeyW":return void k();case"KeyU":return void y()}}),{enemy:f,analysis:m,page:g,conf:b,clickCell:function(t){t.shiftKey?s.logBeast(t.target.id):s.attackBeast(t.target.id)},hoverCell:function(t){let e=s.beast(t.target.id);!e||e.dead?n("enemy",f=null):(e.updateBattler(),n("enemy",f=e))},unHoverCell:function(t){n("enemy",f=null)},moveTimeout:p,undo:y,bigNum:function(t){let e;for(e=0;Math.abs(t)>1e4&&e<w.length;e++)t/=1e3;return Math.round(t)+w[e]},open:$,playFromConf:function(){for(let t in b)b[t]=+b[t],n("conf",b);s.config(b),s.generate(),s.play()},toggleWhat:k,deleteSave:x,loadSave:_,newSave:N,$game:s,Math:Math,$what:i,$str:r,$vit:a,$def:o,$spd:u,$turns:c,$cash:h,$games:d,div3_binding:function(t){M[t?"unshift":"push"](()=>{n("analysis",m=t)})},click_handler:function(t){return $("board")},click_handler_1:function(t){return $("files")},click_handler_2:function(t){const e=i=!1;return Q.set(i),e},input0_input_handler:function(){b.seed=this.value,n("conf",b)},input1_input_handler:function(){b.width=this.value,n("conf",b)},input2_input_handler:function(){b.height=this.value,n("conf",b)},click_handler_3:function({save:t},e){return x(t[0])},click_handler_4:function({save:t},e){return"#NEW"==t[1]?N(t[0]):_(t[0])}}}class Wt extends F{constructor(t){super(),D(this,t,Ht,Bt,o,[])}}return window.onload=function(){new ut({width:50,height:100,seed:5},"auto"),app=new Wt({target:document.body})},app}();

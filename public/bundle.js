!function(){"use strict";function t(){}const e=t=>t;function s(t,e){for(const s in e)t[s]=e[s];return t}function n(t){return t()}function r(){return Object.create(null)}function a(t){t.forEach(n)}function i(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(t,e,s){const n=e.subscribe(s);t.$$.on_destroy.push(n.unsubscribe?()=>n.unsubscribe():n)}let c="undefined"!=typeof window?()=>window.performance.now():()=>Date.now(),d=t=>requestAnimationFrame(t);const u=new Set;let h,g=!1;function f(){u.forEach(t=>{t[0](c())||(u.delete(t),t[1]())}),(g=u.size>0)&&d(f)}function m(t,e){t.appendChild(e)}function p(t,e,s){t.insertBefore(e,s||null)}function b(t){t.parentNode.removeChild(t)}function v(t,e){for(;t.nextSibling&&t.nextSibling!==e;)t.parentNode.removeChild(t.nextSibling)}function y(t,e){for(let s=0;s<t.length;s+=1)t[s]&&t[s].d(e)}function $(t){return document.createElement(t)}function w(t){return document.createTextNode(t)}function k(){return w(" ")}function x(){return w("")}function _(t,e,s,n){return t.addEventListener(e,s,n),()=>t.removeEventListener(e,s,n)}function A(t,e,s){null==s?t.removeAttribute(e):t.setAttribute(e,s)}function M(t,e){e=""+e,t.data!==e&&(t.data=e)}function O(t,e,s){t.style.setProperty(e,s)}function T(t,e){for(let s=0;s<t.options.length;s+=1){const n=t.options[s];if(n.__value===e)return void(n.selected=!0)}}function S(t){h=t}const C=[],L=[],j=[],P=[],N=Promise.resolve();let E=!1;function H(t){j.push(t)}function W(){const t=new Set;do{for(;C.length;){const t=C.shift();S(t),D(t.$$)}for(;L.length;)L.pop()();for(let e=0;e<j.length;e+=1){const s=j[e];t.has(s)||(s(),t.add(s))}j.length=0}while(C.length);for(;P.length;)P.pop()();E=!1}function D(t){t.fragment&&(t.update(t.dirty),a(t.before_update),t.fragment.p(t.dirty,t.ctx),t.dirty=null,t.after_update.forEach(H))}const R=new Set;let F;function U(){F={r:0,c:[],p:F}}function q(){F.r||a(F.c),F=F.p}function B(t,e){t&&t.i&&(R.delete(t),t.i(e))}function I(t,e,s,n){if(t&&t.o){if(R.has(t))return;R.add(t),F.c.push(()=>{R.delete(t),n&&(s&&t.d(1),n())}),t.o(e)}}const Y="undefined"!=typeof window?window:global;function z(t,e){const s={},n={},r={$$scope:1};let a=t.length;for(;a--;){const i=t[a],o=e[a];if(o){for(const t in i)t in o||(n[t]=1);for(const t in o)r[t]||(s[t]=o[t],r[t]=1);t[a]=o}else for(const t in i)r[t]=1}for(const t in n)t in s||(s[t]=void 0);return s}function K(t,e,s){const{fragment:r,on_mount:o,on_destroy:l,after_update:c}=t.$$;r.m(e,s),H(()=>{const e=o.map(n).filter(i);l?l.push(...e):a(e),t.$$.on_mount=[]}),c.forEach(H)}function G(t,e){t.$$.fragment&&(a(t.$$.on_destroy),t.$$.fragment.d(e),t.$$.on_destroy=t.$$.fragment=null,t.$$.ctx={})}function J(t,e){t.$$.dirty||(C.push(t),E||(E=!0,N.then(W)),t.$$.dirty=r()),t.$$.dirty[e]=!0}function Q(e,s,n,i,o,l){const c=h;S(e);const d=s.props||{},u=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:o,bound:r(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(c?c.$$.context:[]),callbacks:r(),dirty:null};let g=!1;var f;u.ctx=n?n(e,d,(t,s)=>{u.ctx&&o(u.ctx[t],u.ctx[t]=s)&&(u.bound[t]&&u.bound[t](s),g&&J(e,t))}):d,u.update(),g=!0,a(u.before_update),u.fragment=i(u.ctx),s.target&&(s.hydrate?u.fragment.l((f=s.target,Array.from(f.childNodes))):u.fragment.c(),s.intro&&B(e.$$.fragment),K(e,s.target,s.anchor),W()),S(c)}class X{$destroy(){G(this,1),this.$destroy=t}$on(t,e){const s=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return s.push(e),()=>{const t=s.indexOf(e);-1!==t&&s.splice(t,1)}}$set(){}}function V(e,s=t){let n;const r=[];function a(t){if(o(e,t)){if(e=t,!n)return;r.forEach(t=>t[1]()),r.forEach(t=>t[0](e))}}return{set:a,update:function(t){a(t(e))},subscribe:function(i,o=t){const l=[i,o];return r.push(l),1===r.length&&(n=s(a)||t),i(e),()=>{const t=r.indexOf(l);-1!==t&&r.splice(t,1),0===r.length&&(n(),n=null)}}}}function Z(t){return"[object Date]"===Object.prototype.toString.call(t)}function tt(t,e){if(t===e||t!=t)return()=>t;const s=typeof t;if(s!==typeof e||Array.isArray(t)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(t)){const s=e.map((e,s)=>tt(t[s],e));return t=>s.map(e=>e(t))}if("object"===s){if(!t||!e)throw new Error("Object cannot be null");if(Z(t)&&Z(e)){t=t.getTime();const s=(e=e.getTime())-t;return e=>new Date(t+e*s)}const s=Object.keys(e),n={};return s.forEach(s=>{n[s]=tt(t[s],e[s])}),t=>{const e={};return s.forEach(s=>{e[s]=n[s](t)}),e}}if("number"===s){const s=e-t;return e=>t+e*s}throw new Error(`Cannot interpolate ${s} values`)}function et(t,n={}){const r=V(t);let a,i=t;function o(o,l){i=o;let h=a,m=!1,{delay:p=0,duration:b=400,easing:v=e,interpolate:y=tt}=s(s({},n),l);const $=c()+p;let w;return(a=function(t){let e;return g||(g=!0,d(f)),{promise:new Promise(s=>{u.add(e=[t,s])}),abort(){u.delete(e)}}}(e=>{if(e<$)return!0;m||(w=y(t,o),"function"==typeof b&&(b=b(t,o)),m=!0),h&&(h.abort(),h=null);const s=e-$;return s>b?(r.set(t=o),!1):(r.set(t=w(v(s/b))),!0)})).promise}return{set:o,update:(e,s)=>o(e(i,t),s),subscribe:r.subscribe}}let st={duration:200,easing:t=>t};const nt=V({}),rt=V({}),at=V([]),it=V(null);let ot,lt=V({}),ct=V({});function dt(t){ot?ot.set(t):(ot=et(t,st),lt.set(ot))}const ut=V(!0);let ht;ut.set("no"!=localStorage.what),ut.subscribe(t=>localStorage.setItem("what",t?"yes":"no")),ct.set(localStorage.settings?JSON.parse(localStorage.settings):{sound:!0,abridgedAnalysis:!1}),ct.subscribe(t=>localStorage.setItem("settings",JSON.stringify(t))),it.subscribe(t=>{ht&&ht!=t&&location.reload(),ht=t});const gt=V([]);let ft="game ",mt=ft.length;function pt(){let t=[];for(let e in localStorage)if("auto"==e||e.substr(0,mt)==ft){let s=JSON.parse(localStorage[e]),n=(Number(e.substr(mt)),"?");try{n=`t${s.turns.length} ${s.conf.width}x${s.conf.height} #${s.conf.seed} ${s.date.toLocaleString()}`}catch(t){console.error(t)}"auto"==e?t.unshift([e,n]):t.push([e,n])}t.push([bt(),"#NEW"]),gt.set(t)}function bt(){let t=0;for(let e in localStorage)if(e.substr(0,mt)==ft){let s=Number(e.substr(mt));s>=t&&(t=s+1)}return ft+t}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var vt,yt=(function(t,e){t.exports=function(){var t=624,e=397,s=function(e){void 0===e&&(e=(new Date).getTime()),this.mt=new Array(t),this.mti=625,this.seed(e)};s.prototype.seed=function(e){var s;for(this.mt[0]=e>>>0,this.mti=1;this.mti<t;this.mti++)s=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(1812433253*((4294901760&s)>>>16)<<16)+1812433253*(65535&s)+this.mti,this.mt[this.mti]>>>=0},s.prototype.seedArray=function(e){var s,n=1,r=0,a=t>e.length?t:e.length;for(this.seed(19650218);a>0;a--)s=this.mt[n-1]^this.mt[n-1]>>>30,this.mt[n]=(this.mt[n]^(1664525*((4294901760&s)>>>16)<<16)+1664525*(65535&s))+e[r]+r,this.mt[n]>>>=0,r++,++n>=t&&(this.mt[0]=this.mt[623],n=1),r>=e.length&&(r=0);for(a=623;a;a--)s=this.mt[n-1]^this.mt[n-1]>>>30,this.mt[n]=(this.mt[n]^(1566083941*((4294901760&s)>>>16)<<16)+1566083941*(65535&s))-n,this.mt[n]>>>=0,++n>=t&&(this.mt[0]=this.mt[623],n=1);this.mt[0]=2147483648},s.prototype.int=function(){var s,n,r=new Array(0,2567483615);if(this.mti>=t){for(625===this.mti&&this.seed(5489),n=0;n<227;n++)s=2147483648&this.mt[n]|2147483647&this.mt[n+1],this.mt[n]=this.mt[n+e]^s>>>1^r[1&s];for(;n<623;n++)s=2147483648&this.mt[n]|2147483647&this.mt[n+1],this.mt[n]=this.mt[n+(e-t)]^s>>>1^r[1&s];s=2147483648&this.mt[623]|2147483647&this.mt[0],this.mt[623]=this.mt[396]^s>>>1^r[1&s],this.mti=0}return s=this.mt[this.mti++],s^=s>>>11,s^=s<<7&2636928640,s^=s<<15&4022730752,(s^=s>>>18)>>>0},s.prototype.int31=function(){return this.int()>>>1},s.prototype.real=function(){return this.int()*(1/4294967295)},s.prototype.realx=function(){return(this.int()+.5)*(1/4294967296)},s.prototype.rnd=function(){return this.int()*(1/4294967296)},s.prototype.random=s.prototype.rnd,s.prototype.rndHiRes=function(){var t=this.int()>>>5,e=this.int()>>>6;return(67108864*t+e)*(1/9007199254740992)};var n=new s;return s.random=function(){return n.rnd()},s}()}(vt={exports:{}},vt.exports),vt.exports);class $t{constructor(t,e,s){this.game=t,this.kind=e,this.id=s,this.cells=[],this.neighbors=[],this.resolved=!1,this.reached=!1}addNeighbor(t){t&&!this.neighbors.includes(t)&&(this.neighbors.push(t),t.neighbors.push(this))}reach(){this.reached||(this.reached=!0,"none"==this.kind&&this.resolve(),this.updateAnalysis())}resolve(){if(!this.resolved){this.resolved=!0;for(let t of this.neighbors)t.reach();this.none||this.loot()}}get possible(){return 1==this.possibility}get possibility(){return 0}loot(){}get lootRatio(){return.1}get score(){return this.cells.length*(this.dream?this.scorePerDream:1)}get scorePerDream(){return 100}get scorePerTurn(){return 3}get xp(){return null}get wasted(){return!this.resolved&&this.game.wasted(this.last)}get dream(){return"dream"==this.kind}get none(){return"none"==this.kind}get color(){return this.game.colors(this.kind)}reset(){this.reached=!1,this.resolved=!1}updateAnalysis(){}get deathText(){if("dream"==this.kind)return{class:"dream",text:this.scorePerDream};let t=this.xp;return t&&t.length>=2?{class:t[0],text:t[1]}:void 0}}class wt{constructor(t,e){this.twister=new yt,this.board=[],this.figs=[],this.turns=[],this.persist=null,e&&(this.persist=e),this.config(t),it.set(this)}colors(t){return t}start(){this.generate(),this.play(),this.saveAuto()}config(t){return this.conf=t,this}load(t){if("string"==typeof t){let e=wt.loadRaw(t);return!!e&&(this.deserialize(e),!0)}this.deserialize(t)}static loadRaw(t){if(!t)return null;let e=localStorage.getItem(t);return e&&"undefined"!=e?JSON.parse(e):null}save(t){t||(t=bt()),localStorage.setItem(t,JSON.stringify(this.serialized()))}erase(t){localStorage.removeItem(t)}get savedFields(){return"conf turns".split(" ")}serialized(){let t={date:new Date};for(let e of this.savedFields)t[e]=this[e];return t}get cellsNumber(){return this.width*this.height}get width(){return this.conf.width}get height(){return this.conf.height}deserialize(t){for(let e in t)this[e]=t[e];this.generate(),this.play(t.turns)}get dreamFrequency(){return 400}cellGenerator(t){return 0}get colorsList(){return["none"]}generate(){this.turns=[],this.figs=[],this.twister.seed(this.conf.seed),this.rni=this.twister.int.bind(this.twister),this.deltas=[-1,1,-this.width,+this.width];let t=[...Array(this.cellsNumber)].map((t,e)=>this.cellGenerator(e));for(let e=0;e<this.cellsNumber;e+=Math.floor(this.dreamFrequency/2)+this.rni()%this.dreamFrequency)0!=e&&(t[e]=1);this.board=t.map(t=>null);for(let e in t)this.populate(t,Number(e))}createFig(t,e){return new $t(this,t,e)}populate(t,e){if(this.board[e])return;let s=t[e],n=this.colorsList[s],r=[e],a=this.createFig(n,this.figs.length);for(this.figs.push(a);r.length>0;){let e=r.pop();this.board[e]=a,a.cells.push(e);for(let n of this.deltas){let i=e+n;1==Math.abs(n)&&Math.floor(e/this.width)!=Math.floor(i/this.width)||(this.board[i]?a.addNeighbor(this.board[i]):t[i]==s&&r.push(i))}}a.last=a.cells.reduce((t,e)=>t>e?t:e);let i=a.cells.map(t=>this.row(t));a.depth=Math.round(i.reduce((t,e)=>t+e)/a.cells.length)}row(t){return Math.floor(t/this.width)}init(){}play(t=[]){this.init(),this.turns=t,this.score=0,this.dreamsTotal=0,this.haveMoves=!0;for(let t of this.figs)t.reset(),t.dream&&this.dreamsTotal++;for(let t=0;t<this.width;t++)this.board[t].reach();for(let e of t)this.figs[e]&&this.figs[e].resolve();this.saveAuto(),this.stateChanged()}attackFigAt(t){let e=this.board[t];return e?e.wasted?null:e&&e.possible?(e.resolve(),this.turns.push(e.id),this.stateChanged(),this.saveAuto(),e):null:null}saveAuto(){this.save(this.persist)}wipeAuto(){localStorage.removeItem(this.persist)}updateResolutions(){this.haveMoves=!1;for(let t of this.figs)t.reached&&!t.resolved&&(t.possible&&(this.haveMoves=!0),t.updateAnalysis())}undo(){this.turns.length>0&&this.play(this.turns.slice(0,-1))}reset(){this.play()}logFigAt(t){let e=this.board[t];e.updateAnalysis(),console.log(e)}fig(t){return this.figs[t]}figAt(t){return this.board[t]}stateExtraFields(){return{}}stateChanged(){this.updateResolutions(),this.dreamsResolved=0,this.dreamsWasted=0;for(let t of this.figs)t.dream&&(t.resolved?this.dreamsResolved++:t.wasted&&this.dreamsWasted++);nt.set(this.conf),at.set(this.board),this.complete=this.dreamsResolved+this.dreamsWasted==this.dreamsTotal||!this.haveMoves;let t={turns:this.turns.length,score:this.score,wasteDepth:this.wasteDepth,turnsToWaste:this.turnsToWaste,complete:this.complete?1:0,haveMoves:this.haveMoves?1:0};Object.assign(t,this.stateExtraFields()),dt(t),rt.set(this.debrief)}get wasteDepth(){return Math.max(0,Math.floor((this.turns.length-this.wastedDelay)/this.turnsPerWastedLine))}get turnsToWaste(){let t=this.turns.length-this.wastedDelay;return t<0?-t:this.turnsPerWastedLine-t%this.turnsPerWastedLine}wasted(t){return t<this.width*this.wasteDepth}get turnsPerWastedLine(){return 3}get wastedDelay(){return 20}get debrief(){let t={score:this.score,dreamsResolved:this.dreamsResolved,dreamsWasted:this.dreamsWasted,turns:this.turns.length,challengeUrl:this.challengeUrl};for(let e of this.figs)e.resolved&&(t[e.kind]=(t[e.kind]||0)+e.cells.length);return t}get challengeUrl(){let t={};Object.assign(t,this.conf),t.goal=this.score;let e=new URLSearchParams(t);return window.location.host+window.location.pathname+"#"+e.toString()}colorAt(t){return this.figAt(t).color}get statsOrder(){return[]}get mode(){return this.conf.mode}}!function(t){t.Config=class{}}(wt||(wt={}));var kt=wt;const xt=20;class _t{constructor(t){this.bats=t,this.time=0,this.log=[],this.hp=[];for(let e of t)e.hp=e.vit,e.nextAttack=e.interval();t[0].seed(t[1]),t[1].seed(t[0]);let e=30;for(;!this.over()&&e-- >0;){let e=Math.min(...t.map(t=>t.nextAttack));this.time=e;for(let e of t)if(e.nextAttack<=this.time&&!(e.hp<=0)){let s=t[0]==e?t[1]:t[0];this.log.push(e.attack(s,this))}}this.hp=this.bats.map(t=>t.hp),t[0].hp<=0?this.outcome="lose":t[1].hp<=0?this.outcome="win":this.outcome="draw","win"==this.outcome?this.success=1:this.success=Math.max(.1,Math.min(1-t[1].hp/t[1].vit,.9))}get enemy(){return this.bats[1]}over(){return this.log.length>=xt||!this.bats.every(t=>t.hp>0)}}class At{constructor(t){this.fig=t,this.twister=new yt}stats(t){return Object.assign(this,t),this}interval(){return 1e4/this.spd}rni(){return this.twister.int()}seed(t){let e=100+2*Math.abs(t.fig?t.fig.id:-1)+(this.fig?this.fig.id:-1);this.twister.seed(e)}get isProto(){return!this.fig}update(){let t={};for(let e in At.statsBase)t[e]=0;t[this.fig.kind]=4*this.fig.cells.length;for(let e of this.fig.neighbors)e.resolved||(t[e.kind]+=e.cells.length);for(let e in At.statsBase)this[e]=Math.floor(At.statsBase[e]*(10+2*t[e])*Math.pow(10,1+this.fig.depth/20)/100);return this.battle=new _t([this.fig.monstromino.prota,this]),this}attack(t,e){this.nextAttack=e.time+this.interval();let s=0,n=this.rni(),r=Math.floor((n%1e6/1e6+.5)*this.str);return(s=Math.max(0,r-t.def))>0&&(t.hp-=s),{a:this,d:t,damage:s,damageRoll:r,def:t.def,hp:t.hp}}}function Mt(t,e){let s=e()%t.reduce((t,e)=>t+e)-t[0],n=0;for(;s>=0;)s-=t[++n];return n}At.statsBase={str:10,vit:30,def:10,spd:10,dream:0};let Ot=" K M B t q Q s S o n d U D T Qt Qd Sd St O N v c".split(" ");function Tt(t){if(isNaN(+t))return t;let e;for(e=0;Math.abs(t)>1e5&&e<Ot.length;e++)t/=1e3;return Math.round(t)+Ot[e]}function St(t,...e){return t.replace(/{(\d+)}/g,function(t,s){return void 0!==e[s]?e[s]:t})}class Ct extends $t{get battler(){return this.battle?this.battle.enemy:null}get monstromino(){return this.game}loot(){this.game.score+=this.score-this.scorePerTurn;let t=this.kind;"none"!=t&&(this.monstromino.prota[t]+=Math.floor(this.battle.enemy[t]*this.lootRatio))}get xp(){if("dream"==this.kind)return null;let t=this.kind;return[t,Math.floor(this.battle.enemy[t]/10)]}updateAnalysis(){if(this.resolved||"none"==this.kind)return this.battle=null,this;let t={str:0,vit:0,def:0,spd:0,dream:0};t[this.kind]=4*this.cells.length;for(let e of this.neighbors)e.resolved||(t[e.kind]+=2*e.cells.length);let e=new At(this);for(let e of this.game.statsOrder)t[e]+=2*t.dream;t.dream=0;for(let s in At.statsBase)e[s]=Math.floor(At.statsBase[s]*(5+t[s])*Math.pow(10,1+.05*this.depth)*.015);return this.battle=new _t([this.monstromino.prota,e]),this}reset(){super.reset(),this.battle=null}get possibility(){return!this.reached||this.resolved||this.wasted?0:this.battle?this.battle.success:0}}const Lt={str:"red",vit:"green",def:"yellow",spd:"blue",none:"none",dream:"dream"};class jt extends kt{get statsOrder(){return["str","vit","def","spd"]}get colorsList(){return["none","dream","str","vit","def","spd"]}colors(t){return Lt[t]}createFig(t,e){return new Ct(this,t,e)}cellGenerator(t){return Mt([1,0,1,1,1,1],this.rni)}init(){this.prota=(new At).stats({str:25,vit:40,def:10,spd:30})}stateExtraFields(){return{str:this.prota.str,vit:this.prota.vit,def:this.prota.def,spd:this.prota.spd}}get dreamFrequency(){return 400}}class Pt extends $t{loot(){let t=this.rainbow.colorsList.indexOf(this.kind);t>1&&(t+=1)>=this.rainbow.colorsList.length&&(t=2),this.rainbow.color=t,this.game.score+=this.score-3}get rainbow(){return this.game}get possibility(){return this.reached&&!this.resolved&&(this.rainbow.color<=1||"dream"==this.kind||this.rainbow.colorsList.indexOf(this.kind)==this.rainbow.color)?1:0}}class Nt extends kt{get statsOrder(){return[]}get colorsList(){return["none","dream","red","yellow","green","blue","violet"]}createFig(t,e){return new Pt(this,t,e)}cellGenerator(t){return Mt([1,0,1,1,1,1,1],this.rni)}init(){this.color=0}get dreamFrequency(){return 400}get turnsPerWastedLine(){return 2}get wastedDelay(){return 10}}class Et{power(t){return(Object.values(this).reduce((t,e)=>t+e)+(t?2*this[t]:0))/3}}const Ht={self:10,friends:10,family:10,career:10};class Wt extends $t{reset(){super.reset(),this.stats=new Et}loot(){this.game.score+=this.score-this.scorePerTurn,this.kind in this.stats&&(this.life.prota[this.kind]+=Math.floor(this.stats[this.kind]*this.lootRatio))}get lootRatio(){return.07}get scorePerDream(){return 100}get life(){return this.game}get possibility(){if(!this.reached||this.resolved||this.wasted)return 0;this.stats||this.updateAnalysis();let t=0;if(this.dream){t=Object.keys(this.stats).map(t=>this.life.prota[t]/this.stats[t]).reduce((t,e)=>t<e?t:e)}else{let e=this.stats[this.kind];t=this.life.prota.power(this.kind)/e}return t>=1?1:t}get outcome(){return this.possible?"possible":"impossible"}updateAnalysis(){if(this.resolved||"none"==this.kind)return this;let t={self:0,friends:0,family:0,career:0,dream:0};t[this.kind]=4*this.cells.length;for(let e of this.neighbors)e.resolved||(t[e.kind]+=2*e.cells.length*(this.dream||e.dream?2:1));for(let e of this.life.statsOrder)t[e]+=4*t.dream;t.dream=0;let e=this.dream?Object.keys(Ht):[this.kind];for(let s of e)this.stats[s]=Math.floor(Ht[s]*(5+t[s])*Math.pow(10,1+.03*this.depth)*.015)}get xp(){return"dream"==this.kind?null:[this.kind,Math.floor(this.stats[this.kind]*this.lootRatio)]}get color(){if(this.dream){this.updateAnalysis();let t=Object.keys(this.stats).reduce(([t,e],s)=>{let n=this.life.prota[s]/this.stats[s];return n<t?[n,s]:[t,e]},[1,0]);return t[0]>=1?this.game.colors("none"):this.game.colors(t[1])}return this.game.colors(this.kind)}}const Dt={self:"red",friends:"yellow",family:"green",career:"blue",none:"none",dream:"dream"};class Rt extends kt{get statsOrder(){return["self","friends","family","career"]}get colorsList(){return["none","dream","self","friends","family","career"]}colors(t){return Dt[t]}createFig(t,e){return new Wt(this,t,e)}cellGenerator(t){return Mt([1,0,1,1,1,1],this.rni)}init(){this.prota=new Et,Object.assign(this.prota,{self:30,friends:30,family:30,career:30})}stateExtraFields(){return this.prota}get dreamFrequency(){return 300}}function Ft(){let t,e={width:30,height:80,seed:1,mode:"life"};if(document.location.hash){let e=new URLSearchParams(document.location.hash.substr(1));t=Object.fromEntries(e.entries())}let s,n=kt.loadRaw("auto");if(!n)return(s=Ut(t||e,"auto")).start(),s;let r=!t||function(t,e){for(let s in t)if(t[s]!=e[s])return!1;return!0}(n.conf,t);return s=Ut(t||n.conf,"auto"),r?s.load(n):s.start(),console.log(s),s}function Ut(t,e){switch(t.mode){case"rainbow":return new Nt(t,e);case"life":return new Rt(t,e);default:return t.mode="monstromino",new jt(t,e)}}let qt={what_files:'\n<ol type="I">\n  <li>After each your move game is saved to the AUTO slot. \n  <li>You can save in new slot, load any save or delete them with X.\n</ol>  \n  ',tip_str:"Each attack deals random damage between 0% and 200% of this value (before Defense applied).",tip_vit:"Amount of HP when combat starts.",tip_def:"Damage from each attack is reduced by this.",tip_spd:"Frequency of attacks.",tip_score:"Score is +1 per cleared cell, +100 per dream, -3 per turn",tip_erase:"Delete file",tip_wasted:"After {0} turns since the game start and each {1} turns thereafter one row of board is blocked.<br/>Figures completely in blocked area are wasted and forever lost.",tip_ability:"Not implemented yet",wasted:"WASTED"};function Bt(t,e,s){const n=Object.create(t);return n.stat=e[s],n}function It(t,e,s){const n=Object.create(t);return n.stat=e[s],n}function Yt(t,e,s){const n=Object.create(t);return n.stat=e[s],n}function zt(t,e,s){const n=Object.create(t);return n.stat=e[s],n}function Kt(t,e,s){const n=Object.create(t);return n.stat=e[s],n}function Gt(t,e,s){const n=Object.create(t);return n.stat=e[s],n}function Jt(t){for(var e,s,n,r,a,i,o,l,c,d,u,h,g,f,v,x,_,M,O,T,S,C,L,j=t.$game.statsOrder,P=[],N=0;N<j.length;N+=1)P[N]=Qt(Gt(t,j,N));var E=t.$game.statsOrder,H=[];for(N=0;N<E.length;N+=1)H[N]=Xt(Kt(t,E,N));var W=t.$game.statsOrder,D=[];for(N=0;N<W.length;N+=1)D[N]=Vt(zt(t,W,N));return{c(){(e=$("tr")).innerHTML='<td class="svelte-23rsga">Objective</td> <td class="svelte-23rsga">\n\t\t\t        Collect all\n\t\t\t        <span class="shiny-inline"></span>\n\t\t\t        dreams.\n\t\t\t      </td>',s=k(),(n=$("tr")).innerHTML='<td class="svelte-23rsga">Method</td> <td class="svelte-23rsga">\n\t\t\t        You can collect a dream or any other figure by clicking it. But only if\n\t\t\t        you have a path to it and can defeat a beast guarding it in combat.\n\t\t\t      </td>',r=k(),(a=$("tr")).innerHTML='<td class="svelte-23rsga">Stats</td> <td class="svelte-23rsga">\n\t\t\t        Enemy stats depend on their depth, size, color and neighbors. You gain\n\t\t\t        stats by defeating enemies. Mouse over your stats and score at the top\n\t\t\t        for details of what each of them do.\n\t\t\t      </td>',i=k(),(o=$("tr")).innerHTML='<td class="svelte-23rsga">Combat</td> <td class="svelte-23rsga">\n\t\t\t        Combat is automatic and you know how it will go beforehand. It\'s\n\t\t\t        calculated based on yours and enemy\'s stats. Combat is a draw if it\'s\n\t\t\t        not over after 20 attacks.\n\t\t\t      </td>',l=k(),c=$("tr"),(d=$("td")).textContent="Legend",u=k(),h=$("td");for(var t=0;t<P.length;t+=1)P[t].c();g=w(" - You can defeat it.\r\n        "),f=$("br"),v=k();for(t=0;t<H.length;t+=1)H[t].c();x=w(" - you are too weak for it. Thickness of border is how bad combat with it would go."),_=$("br"),M=k();for(t=0;t<D.length;t+=1)D[t].c();O=w(" - you have not reached it yet."),T=$("br"),S=k(),C=$("span"),L=w(" - dream. Gives no stats, but a lot of score."),A(d,"class","svelte-23rsga"),A(C,"class","shiny-inline"),A(h,"class","svelte-23rsga")},m(t,b){p(t,e,b),p(t,s,b),p(t,n,b),p(t,r,b),p(t,a,b),p(t,i,b),p(t,o,b),p(t,l,b),p(t,c,b),m(c,d),m(c,u),m(c,h);for(var y=0;y<P.length;y+=1)P[y].m(h,null);m(h,g),m(h,f),m(h,v);for(y=0;y<H.length;y+=1)H[y].m(h,null);m(h,x),m(h,_),m(h,M);for(y=0;y<D.length;y+=1)D[y].m(h,null);m(h,O),m(h,T),m(h,S),m(h,C),m(h,L)},p(t,e){if(t.bg||t.$game){j=e.$game.statsOrder;for(var s=0;s<j.length;s+=1){const n=Gt(e,j,s);P[s]?P[s].p(t,n):(P[s]=Qt(n),P[s].c(),P[s].m(h,g))}for(;s<P.length;s+=1)P[s].d(1);P.length=j.length}if(t.bg||t.$game){E=e.$game.statsOrder;for(s=0;s<E.length;s+=1){const n=Kt(e,E,s);H[s]?H[s].p(t,n):(H[s]=Xt(n),H[s].c(),H[s].m(h,x))}for(;s<H.length;s+=1)H[s].d(1);H.length=E.length}if(t.bg||t.$game){W=e.$game.statsOrder;for(s=0;s<W.length;s+=1){const n=zt(e,W,s);D[s]?D[s].p(t,n):(D[s]=Vt(n),D[s].c(),D[s].m(h,O))}for(;s<D.length;s+=1)D[s].d(1);D.length=W.length}},d(t){t&&(b(e),b(s),b(n),b(r),b(a),b(i),b(o),b(l),b(c)),y(P,t),y(H,t),y(D,t)}}}function Qt(t){var e,s;return{c(){A(e=$("span"),"class",s="cell "+t.bg(t.stat))},m(t,s){p(t,e,s)},p(t,n){(t.bg||t.$game)&&s!==(s="cell "+n.bg(n.stat))&&A(e,"class",s)},d(t){t&&b(e)}}}function Xt(t){var e,s;return{c(){A(e=$("span"),"class",s="cell "+t.bg(t.stat)),O(e,"box-shadow","inset 0px 0px 0px 4px rgba(0,0,0,0.3)")},m(t,s){p(t,e,s)},p(t,n){(t.bg||t.$game)&&s!==(s="cell "+n.bg(n.stat))&&A(e,"class",s)},d(t){t&&b(e)}}}function Vt(t){var e,s;return{c(){A(e=$("span"),"class",s="cell "+t.bg(t.stat)+" darken")},m(t,s){p(t,e,s)},p(t,n){(t.bg||t.$game)&&s!==(s="cell "+n.bg(n.stat)+" darken")&&A(e,"class",s)},d(t){t&&b(e)}}}function Zt(t){var e,s,n;return{c(){(e=$("tr")).innerHTML='<td class="svelte-23rsga">Objective</td> <td class="svelte-23rsga">\n\t\t\t        Collect all\n\t\t\t        <span class="shiny-inline"></span>\n\t\t\t        dreams.        \n\t\t\t      </td>',s=k(),(n=$("tr")).innerHTML='<td class="svelte-23rsga">Method</td> <td class="svelte-23rsga">\n\t\t\t        Colors of figure you can collect are rotated in rainbow order (red&gt;yellow&gt;green&gt;blue&gt;violet).\n\t\t\t        <span style="dream">Dream</span> can follow any color and be followed by any color.\n\t\t\t      </td>'},m(t,r){p(t,e,r),p(t,s,r),p(t,n,r)},d(t){t&&(b(e),b(s),b(n))}}}function te(t){for(var e,s,n,r,a,i,o,l,c,d,u,h,g,f,v,x,_,M,T,S,C,L,j,P,N,E,H,W,D,R,F,U,q,B,I,Y,z,K,G,J,Q,X,V,Z=t.$game.statsOrder,tt=[],et=0;et<Z.length;et+=1)tt[et]=ee(Yt(t,Z,et));var st=t.$game.statsOrder,nt=[];for(et=0;et<st.length;et+=1)nt[et]=se(It(t,st,et));var rt=t.$game.statsOrder,at=[];for(et=0;et<rt.length;et+=1)at[et]=ne(Bt(t,rt,et));return{c(){(e=$("tr")).innerHTML='<td class="svelte-23rsga">Objective</td> <td class="svelte-23rsga">\n\t\t\t        Reach your\n\t\t\t        <span class="shiny-inline"></span>\n\t\t\t        dreams and get maximum score.\n\t\t\t      </td>',s=k(),n=$("tr"),(r=$("td")).textContent="Method",a=k(),i=$("td"),o=w("Each colored figure represents some life situation and is relevant to one of life aspects - \r\n        "),l=$("span"),c=w("self"),u=w(",\r\n        "),h=$("span"),g=w("friends"),v=w(",\r\n        "),x=$("span"),_=w("family"),T=w(" or\r\n        "),S=$("span"),C=w("career"),j=w(". Click on it to resolve it and improve relative stat and also open the way to figures behind it."),P=k(),(N=$("tr")).innerHTML='<td class="svelte-23rsga">Resolution</td> <td class="svelte-23rsga">\n\t\t\t        Whether situation is resolvable is dependent on your stats.\n\t\t\t        If the sum of your relevant (i.e. same colored) stat and average of all other stats is more or equal than situation difficulty, then it\'s resolvable.        \n\t\t\t        Dreams work a bit different - they have separate requirements for all stats and all must be met.\n\t\t\t      </td>',E=k(),H=$("tr"),(W=$("td")).textContent="Legend",D=k(),R=$("td");for(var m=0;m<tt.length;m+=1)tt[m].c();F=w(" - resolvable situations.\r\n        "),U=$("br"),q=k();for(m=0;m<nt.length;m+=1)nt[m].c();B=w(" - unresolvable. Thickness of border is how much your stats are insufficient."),I=$("br"),Y=k();for(m=0;m<at.length;m+=1)at[m].c();z=w(" - unreachable."),K=$("br"),G=k(),J=$("span"),Q=w(" - dream. \r\n        If it has a colored border "),X=$("span"),V=w(" then\r\n        you are missing that stat (the most)."),A(r,"class","svelte-23rsga"),A(l,"class",d=t.fg("self")),A(h,"class",f=t.fg("friends")),A(x,"class",M=t.fg("family")),A(S,"class",L=t.fg("career")),A(i,"class","svelte-23rsga"),A(W,"class","svelte-23rsga"),A(J,"class","shiny-inline"),A(X,"class","shiny-inline"),O(X,"box-shadow","inset 0px 0px 0px 4px rgba(0,0,255, 1)"),A(R,"class","svelte-23rsga")},m(t,d){p(t,e,d),p(t,s,d),p(t,n,d),m(n,r),m(n,a),m(n,i),m(i,o),m(i,l),m(l,c),m(i,u),m(i,h),m(h,g),m(i,v),m(i,x),m(x,_),m(i,T),m(i,S),m(S,C),m(i,j),p(t,P,d),p(t,N,d),p(t,E,d),p(t,H,d),m(H,W),m(H,D),m(H,R);for(var f=0;f<tt.length;f+=1)tt[f].m(R,null);m(R,F),m(R,U),m(R,q);for(f=0;f<nt.length;f+=1)nt[f].m(R,null);m(R,B),m(R,I),m(R,Y);for(f=0;f<at.length;f+=1)at[f].m(R,null);m(R,z),m(R,K),m(R,G),m(R,J),m(R,Q),m(R,X),m(R,V)},p(t,e){if(t.fg&&d!==(d=e.fg("self"))&&A(l,"class",d),t.fg&&f!==(f=e.fg("friends"))&&A(h,"class",f),t.fg&&M!==(M=e.fg("family"))&&A(x,"class",M),t.fg&&L!==(L=e.fg("career"))&&A(S,"class",L),t.bg||t.$game){Z=e.$game.statsOrder;for(var s=0;s<Z.length;s+=1){const n=Yt(e,Z,s);tt[s]?tt[s].p(t,n):(tt[s]=ee(n),tt[s].c(),tt[s].m(R,F))}for(;s<tt.length;s+=1)tt[s].d(1);tt.length=Z.length}if(t.bg||t.$game){st=e.$game.statsOrder;for(s=0;s<st.length;s+=1){const n=It(e,st,s);nt[s]?nt[s].p(t,n):(nt[s]=se(n),nt[s].c(),nt[s].m(R,B))}for(;s<nt.length;s+=1)nt[s].d(1);nt.length=st.length}if(t.bg||t.$game){rt=e.$game.statsOrder;for(s=0;s<rt.length;s+=1){const n=Bt(e,rt,s);at[s]?at[s].p(t,n):(at[s]=ne(n),at[s].c(),at[s].m(R,z))}for(;s<at.length;s+=1)at[s].d(1);at.length=rt.length}},d(t){t&&(b(e),b(s),b(n),b(P),b(N),b(E),b(H)),y(tt,t),y(nt,t),y(at,t)}}}function ee(t){var e,s;return{c(){A(e=$("span"),"class",s="cell "+t.bg(t.stat))},m(t,s){p(t,e,s)},p(t,n){(t.bg||t.$game)&&s!==(s="cell "+n.bg(n.stat))&&A(e,"class",s)},d(t){t&&b(e)}}}function se(t){var e,s;return{c(){A(e=$("span"),"class",s="cell "+t.bg(t.stat)),O(e,"box-shadow","inset 0px 0px 0px 4px rgba(0,0,0,0.3)")},m(t,s){p(t,e,s)},p(t,n){(t.bg||t.$game)&&s!==(s="cell "+n.bg(n.stat))&&A(e,"class",s)},d(t){t&&b(e)}}}function ne(t){var e,s;return{c(){A(e=$("span"),"class",s="cell "+t.bg(t.stat)+" darken")},m(t,s){p(t,e,s)},p(t,n){(t.bg||t.$game)&&s!==(s="cell "+n.bg(n.stat)+" darken")&&A(e,"class",s)},d(t){t&&b(e)}}}function re(e){var s,n,r,a="monstromino"==e.$game.mode&&Jt(e),i="rainbow"==e.$game.mode&&Zt(),o="life"==e.$game.mode&&te(e);return{c(){s=$("table"),a&&a.c(),n=k(),i&&i.c(),r=k(),o&&o.c(),A(s,"class","what")},m(t,e){p(t,s,e),a&&a.m(s,null),m(s,n),i&&i.m(s,null),m(s,r),o&&o.m(s,null)},p(t,e){"monstromino"==e.$game.mode?a?a.p(t,e):((a=Jt(e)).c(),a.m(s,n)):a&&(a.d(1),a=null),"rainbow"==e.$game.mode?i||((i=Zt()).c(),i.m(s,r)):i&&(i.d(1),i=null),"life"==e.$game.mode?o?o.p(t,e):((o=te(e)).c(),o.m(s,null)):o&&(o.d(1),o=null)},i:t,o:t,d(t){t&&b(s),a&&a.d(),i&&i.d(),o&&o.d()}}}function ae(t,e,s){let n;l(t,it,t=>{s("$game",n=t)});let{bg:r,fg:a,dream:i}=e;return t.$set=(t=>{"bg"in t&&s("bg",r=t.bg),"fg"in t&&s("fg",a=t.fg),"dream"in t&&s("dream",i=t.dream)}),{bg:r,fg:a,dream:i,$game:n}}class ie extends X{constructor(t){super(),Q(this,t,ae,re,o,["bg","fg","dream"])}}function oe(t,e,s){const n=Object.create(t);return n.save=e[s],n}function le(t){var e,s,n="auto"==t.save[0]?"AUTO":"";return{c(){e=$("span"),s=w(n)},m(t,n){p(t,e,n),m(e,s)},p(t,e){t.$saves&&n!==(n="auto"==e.save[0]?"AUTO":"")&&M(s,n)},d(t){t&&b(e)}}}function ce(t){var e,s,n;function r(...e){return t.click_handler(t,...e)}return{c(){e=$("button"),s=w("X"),A(e,"class","tooltip-bottom"),e.dataset.tooltip=qt.tip_erase,n=_(e,"click",r)},m(t,n){p(t,e,n),m(e,s)},p(e,s){t=s},d(t){t&&b(e),n()}}}function de(t){var e,s,n,r,a,i,o="#NEW"==t.save[1]?"Save in a new slot":t.save[1];function l(t){return"auto"!=t.save[0]&&"#NEW"!=t.save[1]?ce:le}var c=l(t),d=c(t);function u(...e){return t.click_handler_1(t,...e)}return{c(){e=$("li"),d.c(),s=k(),n=$("button"),r=w(o),a=k(),A(n,"class","save"),i=_(n,"click",u)},m(t,i){p(t,e,i),d.m(e,null),m(e,s),m(e,n),m(n,r),m(e,a)},p(n,a){c===(c=l(t=a))&&d?d.p(n,t):(d.d(1),(d=c(t))&&(d.c(),d.m(e,s))),n.$saves&&o!==(o="#NEW"==t.save[1]?"Save in a new slot":t.save[1])&&M(r,o)},d(t){t&&b(e),d.d(),i()}}}function ue(e){for(var s,n,r=[...e.$saves].sort(he),a=[],i=0;i<r.length;i+=1)a[i]=de(oe(e,r,i));return{c(){s=$("div"),n=$("ul");for(var t=0;t<a.length;t+=1)a[t].c();A(s,"class","files")},m(t,e){p(t,s,e),m(s,n);for(var r=0;r<a.length;r+=1)a[r].m(n,null)},p(t,e){if(t.$saves||t.lang){r=[...e.$saves].sort(he);for(var s=0;s<r.length;s+=1){const i=oe(e,r,s);a[s]?a[s].p(t,i):(a[s]=de(i),a[s].c(),a[s].m(n,null))}for(;s<a.length;s+=1)a[s].d(1);a.length=r.length}},i:t,o:t,d(t){t&&b(s),y(a,t)}}}function he(t,e){return Number(t[0].substr(5))<Number(e[0].substr(5))?-1:1}function ge(t,e,s){let n,r;function a(t){console.log("del",t),n.erase(t),pt()}function i(t){console.log("load",t),n.load(t),goTo(n.conf)}function o(t){n.save(t),pt(),console.log("new",t)}return l(t,it,t=>{s("$game",n=t)}),l(t,gt,t=>{s("$saves",r=t)}),pt(),window.onkeydown=(t=>{switch(t.code){case"KeyQ":return void o()}}),{deleteSave:a,loadSave:i,newSave:o,$saves:r,click_handler:function({save:t},e){return a(t[0])},click_handler_1:function({save:t},e){return"#NEW"==t[1]?o(t[0]):i(t[0])}}}class fe extends X{constructor(t){super(),Q(this,t,ge,ue,o,[])}}function me(t,e,s){const n=Object.create(t);return n.move=e[s],n}function pe(t,e,s){const n=Object.create(t);return n.field=e[s],n.i=s,n}function be(t){var e,s,n,r,a,i,o,l,c,d=0==t.i?"":"&nbsp;",u=t.abridgedAnalysis?"":t.field,h=Tt(t.target.battler[t.field]);return{c(){e=$("noscript"),s=$("noscript"),n=k(),r=$("span"),a=w(u),i=k(),o=$("span"),l=w(h),A(r,"class","field-name"),A(o,"class",c=t.fg(t.field))},m(t,c){p(t,e,c),e.insertAdjacentHTML("afterend",d),p(t,s,c),p(t,n,c),p(t,r,c),m(r,a),p(t,i,c),p(t,o,c),m(o,l)},p(t,e){(t.abridgedAnalysis||t.$game)&&u!==(u=e.abridgedAnalysis?"":e.field)&&M(a,u),(t.target||t.$game)&&h!==(h=Tt(e.target.battler[e.field]))&&M(l,h),(t.fg||t.$game)&&c!==(c=e.fg(e.field))&&A(o,"class",c)},d(t){t&&(v(e,s),b(e),b(s),b(n),b(r),b(i),b(o))}}}function ve(t){var e,s,n,r,a,i=t.abridgedAnalysis?"":t.target.xp[0],o=(t.abridgedAnalysis?"":"+")+Tt(t.target.xp[1]);return{c(){e=w(i),s=k(),n=$("span"),r=w(o),A(n,"class",a=t.fg(t.target.xp[0]))},m(t,a){p(t,e,a),p(t,s,a),p(t,n,a),m(n,r)},p(t,s){(t.abridgedAnalysis||t.target)&&i!==(i=s.abridgedAnalysis?"":s.target.xp[0])&&M(e,i),(t.abridgedAnalysis||t.target)&&o!==(o=(s.abridgedAnalysis?"":"+")+Tt(s.target.xp[1]))&&M(r,o),(t.fg||t.target)&&a!==(a=s.fg(s.target.xp[0]))&&A(n,"class",a)},d(t){t&&(b(e),b(s),b(n))}}}function ye(t){var e,s,n,r,a,i,o,l,c,d,u,h,g,f,v=t.move.a.isProto?"Made":"Took",y=Tt(t.move.damageRoll),x=Tt(t.move.def);function _(t){return t.move.damage<=0?ke:we}var O=_(t),T=O(t);return{c(){e=$("div"),s=$("nobr"),n=$("span"),r=w(v),i=k(),o=$("span"),l=w(y),d=w("\r\n          -\r\n          "),u=$("span"),h=w(x),f=k(),T.c(),A(n,"class",a=t.move.a.isProto?"attacking":"defending"),A(o,"class",c=t.fg("str")),A(u,"class",g=t.fg("def")),A(e,"class","complete-log")},m(t,a){p(t,e,a),m(e,s),m(s,n),m(n,r),m(s,i),m(s,o),m(o,l),m(s,d),m(s,u),m(u,h),m(s,f),T.m(s,null)},p(t,e){t.target&&v!==(v=e.move.a.isProto?"Made":"Took")&&M(r,v),t.target&&a!==(a=e.move.a.isProto?"attacking":"defending")&&A(n,"class",a),t.target&&y!==(y=Tt(e.move.damageRoll))&&M(l,y),t.fg&&c!==(c=e.fg("str"))&&A(o,"class",c),t.target&&x!==(x=Tt(e.move.def))&&M(h,x),t.fg&&g!==(g=e.fg("def"))&&A(u,"class",g),O===(O=_(e))&&T?T.p(t,e):(T.d(1),(T=O(e))&&(T.c(),T.m(s,null)))},d(t){t&&b(e),T.d()}}}function $e(t){var e,s;function n(t){return t.move.damage>0?_e:xe}var r=n(t),a=r(t);return{c(){e=$("span"),a.c(),A(e,"class",s=t.move.a.isProto?"attacking":"defending")},m(t,s){p(t,e,s),a.m(e,null)},p(t,i){r===(r=n(i))&&a?a.p(t,i):(a.d(1),(a=r(i))&&(a.c(),a.m(e,null))),t.target&&s!==(s=i.move.a.isProto?"attacking":"defending")&&A(e,"class",s)},d(t){t&&b(e),a.d()}}}function we(t){var e,s,n,r,a,i,o,l,c,d=Tt(t.move.damage),u=Tt(t.move.hp);return{c(){e=w("=\r\n            "),s=$("span"),n=w(d),a=w("\r\n            dmg,\r\n            "),i=$("span"),o=w(u),c=w("\r\n            hp left"),A(s,"class",r=t.fg("str")),A(i,"class",l=t.move.a.isProto?"attacking":"defending")},m(t,r){p(t,e,r),p(t,s,r),m(s,n),p(t,a,r),p(t,i,r),m(i,o),p(t,c,r)},p(t,e){t.target&&d!==(d=Tt(e.move.damage))&&M(n,d),t.fg&&r!==(r=e.fg("str"))&&A(s,"class",r),t.target&&u!==(u=Tt(e.move.hp))&&M(o,u),t.target&&l!==(l=e.move.a.isProto?"attacking":"defending")&&A(i,"class",l)},d(t){t&&(b(e),b(s),b(a),b(i),b(c))}}}function ke(t){var e,s,n,r;return{c(){e=w("=\r\n            "),s=$("span"),n=w("no damage"),A(s,"class",r=t.fg("def"))},m(t,r){p(t,e,r),p(t,s,r),m(s,n)},p(t,e){t.fg&&r!==(r=e.fg("def"))&&A(s,"class",r)},d(t){t&&(b(e),b(s))}}}function xe(e){var s;return{c(){s=w("=")},m(t,e){p(t,s,e)},p:t,d(t){t&&b(s)}}}function _e(t){var e,s=Tt(t.move.hp);return{c(){e=w(s)},m(t,s){p(t,e,s)},p(t,n){t.target&&s!==(s=Tt(n.move.hp))&&M(e,s)},d(t){t&&b(e)}}}function Ae(t){var e,s;function n(t){return t.abridgedAnalysis?$e:ye}var r=n(t),a=r(t);return{c(){a.c(),e=k(),s=$("span")},m(t,n){a.m(t,n),p(t,e,n),p(t,s,n)},p(t,s){r===(r=n(s))&&a?a.p(t,s):(a.d(1),(a=r(s))&&(a.c(),a.m(e.parentNode,e)))},d(t){a.d(t),t&&(b(e),b(s))}}}function Me(e){for(var s,n,r,a,i,o,l,c,d,u,h,g,f,v,x,_=e.abridgedAnalysis?"":"score",O=e.target.score,T=e.target.battle.outcome.toUpperCase(),S=e.$game.statsOrder,C=[],L=0;L<S.length;L+=1)C[L]=be(pe(e,S,L));var j=e.target.xp&&ve(e),P=e.target.battle.log,N=[];for(L=0;L<P.length;L+=1)N[L]=Ae(me(e,P,L));return{c(){s=$("div");for(var t=0;t<C.length;t+=1)C[t].c();n=k(),r=$("div"),j&&j.c(),a=k(),i=w(_),o=k(),l=$("span"),c=w("+ "),d=w(O),u=k(),h=$("div");for(t=0;t<N.length;t+=1)N[t].c();g=k(),f=$("span"),v=w(T),A(s,"class","detached-title"),A(l,"class",e.dream),A(r,"class","battle-outcome"),A(f,"class",x="battle-"+e.target.battle.outcome),A(h,"class","combat-log")},m(t,e){p(t,s,e);for(var b=0;b<C.length;b+=1)C[b].m(s,null);p(t,n,e),p(t,r,e),j&&j.m(r,null),m(r,a),m(r,i),m(r,o),m(r,l),m(l,c),m(l,d),p(t,u,e),p(t,h,e);for(b=0;b<N.length;b+=1)N[b].m(h,null);m(h,g),m(h,f),m(f,v)},p(t,e){if(t.fg||t.$game||t.bigNum||t.target||t.abridgedAnalysis){S=e.$game.statsOrder;for(var n=0;n<S.length;n+=1){const r=pe(e,S,n);C[n]?C[n].p(t,r):(C[n]=be(r),C[n].c(),C[n].m(s,null))}for(;n<C.length;n+=1)C[n].d(1);C.length=S.length}if(e.target.xp?j?j.p(t,e):((j=ve(e)).c(),j.m(r,a)):j&&(j.d(1),j=null),t.abridgedAnalysis&&_!==(_=e.abridgedAnalysis?"":"score")&&M(i,_),t.target&&O!==(O=e.target.score)&&M(d,O),t.dream&&A(l,"class",e.dream),t.abridgedAnalysis||t.target||t.bigNum||t.fg){P=e.target.battle.log;for(n=0;n<P.length;n+=1){const s=me(e,P,n);N[n]?N[n].p(t,s):(N[n]=Ae(s),N[n].c(),N[n].m(h,g))}for(;n<N.length;n+=1)N[n].d(1);N.length=P.length}t.target&&T!==(T=e.target.battle.outcome.toUpperCase())&&M(v,T),t.target&&x!==(x="battle-"+e.target.battle.outcome)&&A(f,"class",x)},i:t,o:t,d(t){t&&b(s),y(C,t),t&&(b(n),b(r)),j&&j.d(),t&&(b(u),b(h)),y(N,t)}}}function Oe(t,e,s){let n,r;l(t,ct,t=>{s("$settings",n=t)}),l(t,it,t=>{s("$game",r=t)});let a,{target:i,fg:o,dream:c}=e;return t.$set=(t=>{"target"in t&&s("target",i=t.target),"fg"in t&&s("fg",o=t.fg),"dream"in t&&s("dream",c=t.dream)}),t.$$.update=((t={$settings:1})=>{t.$settings&&s("abridgedAnalysis",a=n.abridgedAnalysis)}),{target:i,fg:o,dream:c,abridgedAnalysis:a,$game:r}}class Te extends X{constructor(t){super(),Q(this,t,Oe,Me,o,["target","fg","dream"])}}function Se(t,e,s){const n=Object.create(t);return n.field=e[s],n.i=s,n}function Ce(t){var e,s,n,r,a,i,o,l,c,d=0==t.i?"":"&nbsp;",u=t.abridgedAnalysis?"":t.field,h=Tt(t.target.stats[t.field]);return{c(){e=$("noscript"),s=$("noscript"),n=k(),r=$("span"),a=w(u),i=k(),o=$("span"),l=w(h),A(r,"class","field-name"),A(o,"class",c=t.fg(t.field))},m(t,c){p(t,e,c),e.insertAdjacentHTML("afterend",d),p(t,s,c),p(t,n,c),p(t,r,c),m(r,a),p(t,i,c),p(t,o,c),m(o,l)},p(t,e){(t.abridgedAnalysis||t.target)&&u!==(u=e.abridgedAnalysis?"":e.field)&&M(a,u),t.target&&h!==(h=Tt(e.target.stats[e.field]))&&M(l,h),(t.fg||t.target)&&c!==(c=e.fg(e.field))&&A(o,"class",c)},d(t){t&&(v(e,s),b(e),b(s),b(n),b(r),b(i),b(o))}}}function Le(t){var e,s=t.target.stats[t.field]&&Ce(t);return{c(){s&&s.c(),e=x()},m(t,n){s&&s.m(t,n),p(t,e,n)},p(t,n){n.target.stats[n.field]?s?s.p(t,n):((s=Ce(n)).c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null)},d(t){s&&s.d(t),t&&b(e)}}}function je(t){var e,s,n,r=t.target.outcome.toUpperCase();return{c(){e=$("span"),s=w(r),A(e,"class",n="battle-"+t.target.outcome)},m(t,n){p(t,e,n),m(e,s)},p(t,a){t.target&&r!==(r=a.target.outcome.toUpperCase())&&M(s,r),t.target&&n!==(n="battle-"+a.target.outcome)&&A(e,"class",n)},d(t){t&&b(e)}}}function Pe(t){var e,s,n,r,a,i,o,l=t.target.score,c=t.abridgedAnalysis?"":'<span class="field-name">score</span>',d=t.target.xp&&Ne(t);return{c(){d&&d.c(),e=k(),s=$("span"),n=w("+ "),r=w(l),a=k(),i=$("noscript"),o=$("noscript"),A(s,"class",t.dream)},m(t,l){d&&d.m(t,l),p(t,e,l),p(t,s,l),m(s,n),m(s,r),p(t,a,l),p(t,i,l),i.insertAdjacentHTML("afterend",c),p(t,o,l)},p(t,n){n.target.xp?d?d.p(t,n):((d=Ne(n)).c(),d.m(e.parentNode,e)):d&&(d.d(1),d=null),t.target&&l!==(l=n.target.score)&&M(r,l),t.dream&&A(s,"class",n.dream),t.abridgedAnalysis&&c!==(c=n.abridgedAnalysis?"":'<span class="field-name">score</span>')&&(v(i,o),i.insertAdjacentHTML("afterend",c))},d(t){d&&d.d(t),t&&(b(e),b(s),b(a),v(i,o),b(i),b(o))}}}function Ne(t){var e,s,n,r,a,i,o=(t.abridgedAnalysis?"":"+")+Tt(t.target.xp[1]),l=t.abridgedAnalysis?"":t.target.xp[0];return{c(){e=$("span"),s=w(o),r=k(),a=$("span"),i=w(l),A(e,"class",n=t.fg(t.target.xp[0])),A(a,"class","field-name")},m(t,n){p(t,e,n),m(e,s),p(t,r,n),p(t,a,n),m(a,i)},p(t,r){(t.abridgedAnalysis||t.target)&&o!==(o=(r.abridgedAnalysis?"":"+")+Tt(r.target.xp[1]))&&M(s,o),(t.fg||t.target)&&n!==(n=r.fg(r.target.xp[0]))&&A(e,"class",n),(t.abridgedAnalysis||t.target)&&l!==(l=r.abridgedAnalysis?"":r.target.xp[0])&&M(i,l)},d(t){t&&(b(e),b(r),b(a))}}}function Ee(e){for(var s,n,r,a,i,o,l=e.target.game.statsOrder,c=[],d=0;d<l.length;d+=1)c[d]=Le(Se(e,l,d));var u="possible"!=e.target.outcome&&je(e),h="possible"==e.target.outcome&&Pe(e);return{c(){s=$("div");for(var t=0;t<c.length;t+=1)c[t].c();n=k(),r=$("div"),u&&u.c(),a=k(),h&&h.c(),i=k(),o=$("div"),A(s,"class","detached-title"),A(r,"class","battle-outcome"),A(o,"class","combat-log")},m(t,l){p(t,s,l);for(var d=0;d<c.length;d+=1)c[d].m(s,null);p(t,n,l),p(t,r,l),u&&u.m(r,null),m(r,a),h&&h.m(r,null),p(t,i,l),p(t,o,l),o.innerHTML=e.combatLog},p(t,e){if(t.target||t.fg||t.bigNum||t.abridgedAnalysis){l=e.target.game.statsOrder;for(var n=0;n<l.length;n+=1){const r=Se(e,l,n);c[n]?c[n].p(t,r):(c[n]=Le(r),c[n].c(),c[n].m(s,null))}for(;n<c.length;n+=1)c[n].d(1);c.length=l.length}"possible"!=e.target.outcome?u?u.p(t,e):((u=je(e)).c(),u.m(r,a)):u&&(u.d(1),u=null),"possible"==e.target.outcome?h?h.p(t,e):((h=Pe(e)).c(),h.m(r,null)):h&&(h.d(1),h=null),t.combatLog&&(o.innerHTML=e.combatLog)},i:t,o:t,d(t){t&&b(s),y(c,t),t&&(b(n),b(r)),u&&u.d(),h&&h.d(),t&&(b(i),b(o))}}}function He(t,e,s){let n,r,a;l(t,ct,t=>{s("$settings",n=t)}),l(t,it,t=>{s("$game",r=t)}),l(t,ot,t=>{s("$state",a=t)});let i,o,{target:c,fg:d,dream:u}=e;return t.$set=(t=>{"target"in t&&s("target",c=t.target),"fg"in t&&s("fg",d=t.fg),"dream"in t&&s("dream",u=t.dream)}),t.$$.update=((t={$settings:1,target:1,$game:1,$state:1,fg:1})=>{if(t.$settings&&s("abridgedAnalysis",o=n.abridgedAnalysis),t.target||t.$game||t.$state||t.fg)if(c.dream){let t=[];for(let e of r.statsOrder){let s=a[e]>=c.stats[e],n=`\n        <span class=${d(e)}>${Tt(a[e])}</span>\n        <span class="fg-${s?"green":"red"}">${s?">":"<"}</span>\n        <span class=${d(e)}>${Tt(c.stats[e])}</span>\n        `;t.push(n)}s("combatLog",i=t.join("<br/>"))}else{let t,e=[];for(let s of r.statsOrder){let n=`<span class=${Tt(d(s))}>${Tt(a[s])}</span>`;c.kind==s?t=n:e.push(n)}s("combatLog",i=`\n      (${e.join("+")}) / 3 + ${t} = ${Tt(Tt(r.prota.power(c.kind)))}\n      <span class="fg-${c.possible?"green":"red"}">${c.possible?">":"<"}</span>\n      <span class=${d(c.kind)}>${Tt(c.stats[c.kind])}</span>\n      `)}}),{target:c,fg:d,dream:u,combatLog:i,abridgedAnalysis:o}}class We extends X{constructor(t){super(),Q(this,t,He,Ee,o,["target","fg","dream"])}}const{Object:De}=Y;function Re(t,e,s){const n=De.create(t);return n.question=e[s],n}function Fe(t,e,s){const n=De.create(t);return n.fig=e[s],n.i=s,n}function Ue(t,e,s){const n=De.create(t);return n.anim=e[s],n}function qe(t,e,s){const n=De.create(t);return n.field=e[s],n.i=s,n}function Be(t,e,s){const n=De.create(t);return n.stat=e[s],n.i=s,n}function Ie(t){var e,s,n,r,a=[Ke,ze,Ye],i=[];function o(t){return t.target.wasted?0:"monstromino"==t.$game.mode&&t.target.battle?1:"life"==t.$game.mode&&t.target.stats?2:-1}return~(e=o(t))&&(s=i[e]=a[e](t)),{c(){s&&s.c(),n=x()},m(t,s){~e&&i[e].m(t,s),p(t,n,s),r=!0},p(t,r){var l=e;(e=o(r))===l?~e&&i[e].p(t,r):(s&&(U(),I(i[l],1,1,()=>{i[l]=null}),q()),~e?((s=i[e])||(s=i[e]=a[e](r)).c(),B(s,1),s.m(n.parentNode,n)):s=null)},i(t){r||(B(s),r=!0)},o(t){I(s),r=!1},d(t){~e&&i[e].d(t),t&&b(n)}}}function Ye(t){var e,n,r,a=[{target:t.target,fg:t.fg,dream:t.dream}];let i={};for(var o=0;o<a.length;o+=1)i=s(i,a[o]);var l=new We({props:i});return{c(){e=$("div"),l.$$.fragment.c(),A(e,"style",t.analysisPosition),A(e,"class",n="analysis "+(t.moveTimeout?"":"analysis-shown"))},m(s,n){p(s,e,n),K(l,e,null),t.div_binding_1(e),r=!0},p(t,s){var i=t.target||t.fg||t.dream?z(a,[{target:s.target,fg:s.fg,dream:s.dream}]):{};l.$set(i),r&&!t.analysisPosition||A(e,"style",s.analysisPosition),r&&!t.moveTimeout||n===(n="analysis "+(s.moveTimeout?"":"analysis-shown"))||A(e,"class",n)},i(t){r||(B(l.$$.fragment,t),r=!0)},o(t){I(l.$$.fragment,t),r=!1},d(s){s&&b(e),G(l),t.div_binding_1(null)}}}function ze(t){var e,n,r,a=[{target:t.target,fg:t.fg,dream:t.dream}];let i={};for(var o=0;o<a.length;o+=1)i=s(i,a[o]);var l=new Te({props:i});return{c(){e=$("div"),l.$$.fragment.c(),A(e,"style",t.analysisPosition),A(e,"class",n="analysis "+(t.moveTimeout?"":"analysis-shown"))},m(s,n){p(s,e,n),K(l,e,null),t.div_binding(e),r=!0},p(t,s){var i=t.target||t.fg||t.dream?z(a,[{target:s.target,fg:s.fg,dream:s.dream}]):{};l.$set(i),r&&!t.analysisPosition||A(e,"style",s.analysisPosition),r&&!t.moveTimeout||n===(n="analysis "+(s.moveTimeout?"":"analysis-shown"))||A(e,"class",n)},i(t){r||(B(l.$$.fragment,t),r=!0)},o(t){I(l.$$.fragment,t),r=!1},d(s){s&&b(e),G(l),t.div_binding(null)}}}function Ke(e){var s,n,r,a,i,o=qt.wasted,l=St(qt.tip_wasted,e.$game.wastedDelay,e.$game.turnsPerWastedLine);return{c(){s=$("div"),n=$("div"),r=k(),a=$("div"),A(n,"class","detached-title"),A(a,"class","combat-log"),A(s,"style",e.analysisPosition),A(s,"class",i="analysis width-300 "+(e.moveTimeout?"":"analysis-shown"))},m(t,i){p(t,s,i),m(s,n),n.innerHTML=o,m(s,r),m(s,a),a.innerHTML=l,e.div2_binding(s)},p(t,e){t.$game&&l!==(l=St(qt.tip_wasted,e.$game.wastedDelay,e.$game.turnsPerWastedLine))&&(a.innerHTML=l),t.analysisPosition&&A(s,"style",e.analysisPosition),t.moveTimeout&&i!==(i="analysis width-300 "+(e.moveTimeout?"":"analysis-shown"))&&A(s,"class",i)},i:t,o:t,d(t){t&&b(s),e.div2_binding(null)}}}function Ge(t){var e,s,n,r,a;return{c(){(e=$("button")).textContent="back",s=k(),n=$("div"),r=w(t.page),A(e,"class","hotkey"),A(n,"class","page-title"),a=_(e,"click",t.click_handler_3)},m(t,a){p(t,e,a),p(t,s,a),p(t,n,a),m(n,r)},p(t,e){t.page&&M(r,e.page)},d(t){t&&(b(e),b(s),b(n)),a()}}}function Je(t){for(var e,s,n,r,a,i,o,l=t.$game.statsOrder,c=[],d=0;d<l.length;d+=1)c[d]=Qe(Be(t,l,d));return{c(){(e=$("button")).textContent="undo",s=k(),n=$("div");for(var l=0;l<c.length;l+=1)c[l].c();r=k(),a=$("button"),i=w("ability"),A(e,"class","hotkey"),A(n,"class","stats"),A(a,"class","hotkey wip tooltip-bottom"),a.dataset.tooltip=qt.tip_ability,o=_(e,"click",t.undo)},m(t,o){p(t,e,o),p(t,s,o),p(t,n,o);for(var l=0;l<c.length;l+=1)c[l].m(n,null);p(t,r,o),p(t,a,o),m(a,i)},p(t,e){if(t.fg||t.$game||t.lang||t.bigNum||t.$state){l=e.$game.statsOrder;for(var s=0;s<l.length;s+=1){const r=Be(e,l,s);c[s]?c[s].p(t,r):(c[s]=Qe(r),c[s].c(),c[s].m(n,null))}for(;s<c.length;s+=1)c[s].d(1);c.length=l.length}},d(t){t&&(b(e),b(s),b(n)),y(c,t),t&&(b(r),b(a)),o()}}}function Qe(t){var e,s,n,r,a,i,o,l,c,d,u,h=t.i>0?"&nbsp":"",g=t.stat,f=Tt(t.$state[t.stat]);return{c(){e=$("noscript"),s=$("noscript"),n=k(),r=$("span"),a=w(g),i=k(),o=$("span"),l=w(f),c=k(),A(r,"class","field-name"),A(o,"class",d=t.fg(t.stat)+" tooltip-bottom"),o.dataset.tooltip=u=qt["tip_"+t.stat]},m(t,d){p(t,e,d),e.insertAdjacentHTML("afterend",h),p(t,s,d),p(t,n,d),p(t,r,d),m(r,a),p(t,i,d),p(t,o,d),m(o,l),m(o,c)},p(t,e){t.$game&&g!==(g=e.stat)&&M(a,g),(t.$state||t.$game)&&f!==(f=Tt(e.$state[e.stat]))&&M(l,f),t.$game&&d!==(d=e.fg(e.stat)+" tooltip-bottom")&&A(o,"class",d),t.$game&&u!==(u=qt["tip_"+e.stat])&&(o.dataset.tooltip=u)},d(t){t&&(v(e,s),b(e),b(s),b(n),b(r),b(i),b(o))}}}function Xe(t){var e,s,n,r,a,i,o,l,c,d,u=Tt(t.$state.score),h=t.Math.round(t.$state.turns),g=t.$conf.goal&&Ve(t);return{c(){(e=$("span")).textContent="score",s=k(),n=$("span"),r=w(u),a=k(),g&&g.c(),i=k(),(o=$("span")).textContent="turns",l=k(),c=$("span"),d=w(h),A(e,"class","field-name"),A(n,"class",t.dream+" tooltip-bottom"),n.dataset.tooltip=qt.tip_score,A(o,"class","field-name")},m(t,u){p(t,e,u),p(t,s,u),p(t,n,u),m(n,r),p(t,a,u),g&&g.m(t,u),p(t,i,u),p(t,o,u),p(t,l,u),p(t,c,u),m(c,d)},p(t,e){t.$state&&u!==(u=Tt(e.$state.score))&&M(r,u),e.$conf.goal?g?g.p(t,e):((g=Ve(e)).c(),g.m(i.parentNode,i)):g&&(g.d(1),g=null),t.$state&&h!==(h=e.Math.round(e.$state.turns))&&M(d,h)},d(t){t&&(b(e),b(s),b(n),b(a)),g&&g.d(t),t&&(b(i),b(o),b(l),b(c))}}}function Ve(t){var e,s,n,r=t.$conf.goal;return{c(){e=$("span"),s=w("/"),n=w(r),A(e,"class","field-name "+t.dream)},m(t,r){p(t,e,r),m(e,s),m(e,n)},p(t,e){t.$conf&&r!==(r=e.$conf.goal)&&M(n,r)},d(t){t&&b(e)}}}function Ze(t){var e,n=[{fg:t.fg,bg:t.bg,dream:t.dream}];let r={};for(var a=0;a<n.length;a+=1)r=s(r,n[a]);var i=new ie({props:r});return{c(){i.$$.fragment.c()},m(t,s){K(i,t,s),e=!0},p(t,e){var s=t.fg||t.bg||t.dream?z(n,[{fg:e.fg,bg:e.bg,dream:e.dream}]):{};i.$set(s)},i(t){e||(B(i.$$.fragment,t),e=!0)},o(t){I(i.$$.fragment,t),e=!1},d(t){G(i,t)}}}function ts(e){var s,n,r=qt.what_files;return{c(){s=$("noscript"),n=$("noscript")},m(t,e){p(t,s,e),s.insertAdjacentHTML("afterend",r),p(t,n,e)},p:t,i:t,o:t,d(t){t&&(v(s,n),b(s),b(n))}}}function es(t){var e;return{c(){e=w("")},m(t,s){p(t,e,s)},d(t){t&&b(e)}}}function ss(t){var e,s,n,r,a,i,o=Tt(t.$debrief[t.field]),l=t.field,c=t.i>0&&es();return{c(){c&&c.c(),e=w("\r\n      + "),s=w(o),n=k(),r=$("span"),a=w(l),A(r,"class",i=t.fg(t.field))},m(t,i){c&&c.m(t,i),p(t,e,i),p(t,s,i),p(t,n,i),p(t,r,i),m(r,a)},p(t,n){n.i>0?c||((c=es()).c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null),(t.$debrief||t.$game)&&o!==(o=Tt(n.$debrief[n.field]))&&M(s,o),t.$game&&l!==(l=n.field)&&M(a,l),t.$game&&i!==(i=n.fg(n.field))&&A(r,"class",i)},d(t){c&&c.d(t),t&&(b(e),b(s),b(n),b(r))}}}function ns(t){for(var e,s,n,r,i,o,l,c,d,u,h,g,f,v,x,S,C,L,j,P,N,E=t.Math.floor(t.$state.turnsToWaste),W=t.particles,D=[],R=0;R<W.length;R+=1)D[R]=rs(Ue(t,W,R));var F=t.$board,U=[];for(R=0;R<F.length;R+=1)U[R]=as(Fe(t,F,R));var q=["monstromino","rainbow","life"],B=[];for(R=0;R<3;R+=1)B[R]=is(Re(t,q,R));return{c(){e=$("div"),s=$("div"),n=w(E),r=k(),(i=$("span")).textContent="turns",o=k(),l=$("div");for(var a=0;a<D.length;a+=1)D[a].c();c=k();for(a=0;a<U.length;a+=1)U[a].c();d=k(),u=$("div"),h=w("Mode\r\n      "),g=$("select");for(a=0;a<3;a+=1)B[a].c();f=w("\r\n      Seed\r\n      "),v=$("input"),x=w("\r\n      Width\r\n      "),S=$("input"),C=w("\r\n      Height\r\n      "),L=$("input"),j=w("\r\n      \r\n      "),(P=$("button")).textContent="play",A(i,"class","field-name"),A(s,"class","waste-line"),O(s,"width",20*t.$conf.width+100+"px"),O(s,"transform","translateY("+20*t.$state.wasteDepth+"px)"),A(l,"class","animations"),A(e,"class","board-table"),O(e,"width",20*t.$conf.width+"px"),void 0===t.custom.mode&&H(()=>t.select_change_handler.call(g)),A(u,"class","board-conf"),N=[_(e,"mousemove",t.hoverCell),_(e,"mousedown",t.clickCell),_(e,"mouseleave",t.unHoverCell),_(g,"change",t.select_change_handler),_(v,"input",t.input0_input_handler),_(S,"input",t.input1_input_handler),_(L,"input",t.input2_input_handler),_(P,"click",t.playCustom)]},m(a,b){p(a,e,b),m(e,s),m(s,n),m(s,r),m(s,i),m(e,o),m(e,l);for(var y=0;y<D.length;y+=1)D[y].m(l,null);m(e,c);for(y=0;y<U.length;y+=1)U[y].m(e,null);p(a,d,b),p(a,u,b),m(u,h),m(u,g);for(y=0;y<3;y+=1)B[y].m(g,null);T(g,t.custom.mode),m(u,f),m(u,v),v.value=t.custom.seed,m(u,x),m(u,S),S.value=t.custom.width,m(u,C),m(u,L),L.value=t.custom.height,m(u,j),m(u,P)},p(t,r){if(t.$state&&E!==(E=r.Math.floor(r.$state.turnsToWaste))&&M(n,E),t.$conf&&O(s,"width",20*r.$conf.width+100+"px"),t.$state&&O(s,"transform","translateY("+20*r.$state.wasteDepth+"px)"),t.particles){W=r.particles;for(var a=0;a<W.length;a+=1){const e=Ue(r,W,a);D[a]?D[a].p(t,e):(D[a]=rs(e),D[a].c(),D[a].m(l,null))}for(;a<D.length;a+=1)D[a].d(1);D.length=W.length}if(t.cellClasses||t.$board||t.target||t.cellStyle){F=r.$board;for(a=0;a<F.length;a+=1){const s=Fe(r,F,a);U[a]?U[a].p(t,s):(U[a]=as(s),U[a].c(),U[a].m(e,null))}for(;a<U.length;a+=1)U[a].d(1);U.length=F.length}t.$conf&&O(e,"width",20*r.$conf.width+"px"),t.custom&&T(g,r.custom.mode),t.custom&&v.value!==r.custom.seed&&(v.value=r.custom.seed),t.custom&&S.value!==r.custom.width&&(S.value=r.custom.width),t.custom&&L.value!==r.custom.height&&(L.value=r.custom.height)},d(t){t&&b(e),y(D,t),y(U,t),t&&(b(d),b(u)),y(B,t),a(N)}}}function rs(t){var e,s,n,r,a,i,o=t.anim.content||"";return{c(){e=$("div"),s=w(o),n=k(),A(e,"class",r=t.anim.class||"death"),A(e,"style",a=t.anim.style||"")},m(r,a){p(r,e,a),m(e,s),m(e,n),i=function(t,e){let s=e.content?-40:-70,n=e.content?-20:0,r=e.content?1500:200;t.animate([{opacity:1,display:"block",transform:`translate(0px,${n}px) rotate3d(1, 0, 0, 0deg)`},{opacity:0,display:"none",transform:`translate(${60*Math.random()-30}px, ${s}px) rotate3d(${180*Math.random()-90}, ${180*Math.random()-90}, ${180*Math.random()-90}, ${180*Math.random()-90}deg)`}],{duration:r,easing:"ease-out",fill:"forwards"})}.call(null,e,t.anim)||{}},p(n,l){t=l,n.particles&&o!==(o=t.anim.content||"")&&M(s,o),n.particles&&r!==(r=t.anim.class||"death")&&A(e,"class",r),n.particles&&a!==(a=t.anim.style||"")&&A(e,"style",a),"function"==typeof i.update&&n.particles&&i.update.call(null,t.anim)},d(t){t&&b(e),i&&"function"==typeof i.destroy&&i.destroy()}}}function as(t){var e,s,n;return{c(){A(e=$("div"),"id",t.i),A(e,"class",s="cell "+t.cellClasses(t.fig)+"\r\n          "+(t.fig.possible&&!t.fig.wasted&&t.fig==t.target?"aimed":"")+"\r\n          "+(!t.fig.dream||t.fig.resolved||t.fig.wasted?"":"shiny")),A(e,"style",n=t.cellStyle(t.fig))},m(t,s){p(t,e,s)},p(t,r){(t.$board||t.target)&&s!==(s="cell "+r.cellClasses(r.fig)+"\r\n          "+(r.fig.possible&&!r.fig.wasted&&r.fig==r.target?"aimed":"")+"\r\n          "+(!r.fig.dream||r.fig.resolved||r.fig.wasted?"":"shiny"))&&A(e,"class",s),t.$board&&n!==(n=r.cellStyle(r.fig))&&A(e,"style",n)},d(t){t&&b(e)}}}function is(e){var s,n;return{c(){s=$("option"),n=w(e.question),s.__value=e.question,s.value=s.__value},m(t,e){p(t,s,e),m(s,n)},p:t,d(t){t&&b(s)}}}function os(t){var e,s=new fe({});return{c(){s.$$.fragment.c()},m(t,n){K(s,t,n),e=!0},i(t){e||(B(s.$$.fragment,t),e=!0)},o(t){I(s.$$.fragment,t),e=!1},d(t){G(s,t)}}}function ls(t){var e,s,n,r,i,o,l,c,d;return{c(){e=$("div"),s=$("label"),n=$("input"),r=w("\r\n        Sound"),i=k(),o=$("label"),l=$("input"),c=w("\r\n        Shortened combat analysis"),A(n,"type","checkbox"),A(l,"type","checkbox"),A(e,"class","settings"),d=[_(n,"change",t.input0_change_handler),_(l,"change",t.input1_change_handler)]},m(a,d){p(a,e,d),m(e,s),m(s,n),n.checked=t.$settings.sound,m(s,r),m(e,i),m(e,o),m(o,l),l.checked=t.$settings.abridgedAnalysis,m(o,c)},p(t,e){t.$settings&&(n.checked=e.$settings.sound),t.$settings&&(l.checked=e.$settings.abridgedAnalysis)},d(t){t&&b(e),a(d)}}}function cs(t){var e,s,n,r,i,o,l,c,d,u,h,g,f,v,x,T,S,C,L,j,P,N,E,H,W,D,R,F,Y,z,K,G,J,Q,X,V,Z,tt,et,st,nt,rt,at,it,ot,lt,ct,dt,ut,ht,gt,ft,mt,pt,bt,vt,yt,$t,wt,kt,xt,_t,At,Mt,Ot,Tt,St,Ct,Lt,jt,Pt,Nt,Et,Ht,Wt,Dt,Rt,Ft=t.$state.complete?t.$state.haveMoves?"Board clear":"You have failed at life":"",Ut=t.$debrief.score,qt=t.$debrief.dreamsResolved,Bt=t.$debrief.turns,It=t.$debrief.challengeUrl,Yt=t.target&&Ie(t);function zt(t){return"board"==t.page?Je:Ge}var Kt=zt(t),Gt=Kt(t),Jt="board"==t.page&&Xe(t),Qt=[ts,Ze],Xt=[];function Vt(t){return"files"==t.page?0:1}P=Vt(t),N=Xt[P]=Qt[P](t);for(var Zt=t.$game.colorsList.slice(2),te=[],ee=0;ee<Zt.length;ee+=1)te[ee]=ss(qe(t,Zt,ee));var se="board"==t.page&&ns(t),ne="files"==t.page&&os(),re="settings"==t.page&&ls(t);return{c(){Yt&&Yt.c(),e=k(),s=$("div"),n=$("div"),(r=$("button")).textContent="menu",i=k(),o=$("div"),(l=$("button")).textContent="Board",c=k(),(d=$("button")).textContent="Files",u=k(),(h=$("button")).textContent="Settings",g=k(),f=$("div"),v=k(),Gt.c(),x=k(),T=$("div"),S=k(),C=$("div"),Jt&&Jt.c(),L=k(),j=$("div"),N.c(),E=k(),H=$("div"),W=k(),(D=$("button")).textContent="Ok, got it",F=k(),Y=$("div"),z=$("div"),K=w(Ft),G=k(),J=$("div"),Q=$("big"),X=w("Score:\r\n      "),V=$("span"),Z=w(Ut),tt=w("\r\n    =\r\n    "),et=$("br"),st=k(),nt=w(qt),rt=k(),at=$("span"),it=w("dream"),ot=w("\r\n    * 100\r\n    ");for(var a=0;a<te.length;a+=1)te[a].c();lt=w("\r\n    - "),ct=w(Bt),dt=w(" turns * 3\r\n    "),ut=$("br"),ht=k(),gt=$("br"),ft=k(),(mt=$("small")).innerHTML="\n\t\t\t      Challenge url - you can share it with someone who wants to try and beat\n\t\t\t      your record on this board:\n\t\t\t      <br>",pt=k(),bt=$("u"),vt=$("a"),yt=w(It),wt=k(),kt=$("br"),xt=k(),_t=$("br"),At=k(),Mt=$("div"),(Ot=$("button")).textContent="Undo",Tt=k(),(St=$("span")).textContent="Or use the form at the bottom for another board/mode.",Lt=k(),jt=$("div"),se&&se.c(),Pt=k(),ne&&ne.c(),Nt=k(),re&&re.c(),Et=k(),Ht=$("div"),(Wt=$("button")).textContent="Help",A(o,"class","dropdown"),A(n,"class","menu"),A(f,"class","spacer"),A(T,"class","spacer"),A(C,"class","turns"),A(s,"class","header"),A(j,"class",R="bottom panel card "+(t.$what?"":"panel-hidden-s")),A(z,"class","detached-title card large-font"),O(z,"padding","5px"),A(V,"class",t.dream),A(at,"class",t.dream),A(vt,"href",$t=t.$debrief.challengeUrl),O(St,"margin","0px 10px"),A(Mt,"class","buttons-horizontal"),A(J,"class","card wide-lines"),A(Y,"class",Ct="center panel "+(t.$state.complete&&"board"==t.page?"":"panel-hidden")),A(jt,"class","main"),A(Wt,"class","important"),A(Ht,"class","se-corner"),Rt=[_(l,"click",t.click_handler),_(d,"click",t.click_handler_1),_(h,"click",t.click_handler_2),_(D,"click",t.click_handler_4),_(Ot,"click",t.undo),_(Wt,"click",t.toggleWhat)]},m(t,a){Yt&&Yt.m(t,a),p(t,e,a),p(t,s,a),m(s,n),m(n,r),m(n,i),m(n,o),m(o,l),m(o,c),m(o,d),m(o,u),m(o,h),m(s,g),m(s,f),m(s,v),Gt.m(s,null),m(s,x),m(s,T),m(s,S),m(s,C),Jt&&Jt.m(C,null),p(t,L,a),p(t,j,a),Xt[P].m(j,null),m(j,E),m(j,H),m(j,W),m(j,D),p(t,F,a),p(t,Y,a),m(Y,z),m(z,K),m(Y,G),m(Y,J),m(J,Q),m(Q,X),m(Q,V),m(V,Z),m(J,tt),m(J,et),m(J,st),m(J,nt),m(J,rt),m(J,at),m(at,it),m(J,ot);for(var b=0;b<te.length;b+=1)te[b].m(J,null);m(J,lt),m(J,ct),m(J,dt),m(J,ut),m(J,ht),m(J,gt),m(J,ft),m(J,mt),m(J,pt),m(J,bt),m(bt,vt),m(vt,yt),m(J,wt),m(J,kt),m(J,xt),m(J,_t),m(J,At),m(J,Mt),m(Mt,Ot),m(Mt,Tt),m(Mt,St),p(t,Lt,a),p(t,jt,a),se&&se.m(jt,null),m(jt,Pt),ne&&ne.m(jt,null),m(jt,Nt),re&&re.m(jt,null),p(t,Et,a),p(t,Ht,a),m(Ht,Wt),Dt=!0},p(t,n){n.target?Yt?(Yt.p(t,n),B(Yt,1)):((Yt=Ie(n)).c(),B(Yt,1),Yt.m(e.parentNode,e)):Yt&&(U(),I(Yt,1,1,()=>{Yt=null}),q()),Kt===(Kt=zt(n))&&Gt?Gt.p(t,n):(Gt.d(1),(Gt=Kt(n))&&(Gt.c(),Gt.m(s,x))),"board"==n.page?Jt?Jt.p(t,n):((Jt=Xe(n)).c(),Jt.m(C,null)):Jt&&(Jt.d(1),Jt=null);var r=P;if((P=Vt(n))===r?Xt[P].p(t,n):(U(),I(Xt[r],1,1,()=>{Xt[r]=null}),q(),(N=Xt[P])||(N=Xt[P]=Qt[P](n)).c(),B(N,1),N.m(j,E)),Dt&&!t.$what||R===(R="bottom panel card "+(n.$what?"":"panel-hidden-s"))||A(j,"class",R),Dt&&!t.$state||Ft===(Ft=n.$state.complete?n.$state.haveMoves?"Board clear":"You have failed at life":"")||M(K,Ft),Dt&&!t.$debrief||Ut===(Ut=n.$debrief.score)||M(Z,Ut),Dt&&!t.$debrief||qt===(qt=n.$debrief.dreamsResolved)||M(nt,qt),t.fg||t.$game||t.bigNum||t.$debrief){Zt=n.$game.colorsList.slice(2);for(var a=0;a<Zt.length;a+=1){const e=qe(n,Zt,a);te[a]?te[a].p(t,e):(te[a]=ss(e),te[a].c(),te[a].m(J,lt))}for(;a<te.length;a+=1)te[a].d(1);te.length=Zt.length}Dt&&!t.$debrief||Bt===(Bt=n.$debrief.turns)||M(ct,Bt),Dt&&!t.$debrief||It===(It=n.$debrief.challengeUrl)||M(yt,It),Dt&&!t.$debrief||$t===($t=n.$debrief.challengeUrl)||A(vt,"href",$t),Dt&&!t.$state&&!t.page||Ct===(Ct="center panel "+(n.$state.complete&&"board"==n.page?"":"panel-hidden"))||A(Y,"class",Ct),"board"==n.page?se?se.p(t,n):((se=ns(n)).c(),se.m(jt,Pt)):se&&(se.d(1),se=null),"files"==n.page?ne?B(ne,1):((ne=os()).c(),B(ne,1),ne.m(jt,Nt)):ne&&(U(),I(ne,1,1,()=>{ne=null}),q()),"settings"==n.page?re?re.p(t,n):((re=ls(n)).c(),re.m(jt,null)):re&&(re.d(1),re=null)},i(t){Dt||(B(Yt),B(N),B(ne),Dt=!0)},o(t){I(Yt),I(N),I(ne),Dt=!1},d(t){Yt&&Yt.d(t),t&&(b(e),b(s)),Gt.d(),Jt&&Jt.d(),t&&(b(L),b(j)),Xt[P].d(),t&&(b(F),b(Y)),y(te,t),t&&(b(Lt),b(jt)),se&&se.d(),ne&&ne.d(),re&&re.d(),t&&(b(Et),b(Ht)),a(Rt)}}}function ds(t){return"#"+("000000"+t.toString(16)).substr(-6)}function us(t,e,s){let n,r,a,i,o,c,d;l(t,it,t=>{s("$game",n=t)}),l(t,ct,t=>{s("$settings",r=t)}),l(t,ut,t=>{s("$what",a=t)}),l(t,ot,t=>{s("$state",i=t)}),l(t,nt,t=>{s("$conf",o=t)}),l(t,rt,t=>{s("$debrief",c=t)}),l(t,at,t=>{s("$board",d=t)});let u,h,g,f=[new Audio("paper2.ogg"),new Audio("paper.ogg")],m=new Audio("bell.ogg"),p="board",b=[0,0],v={monstromino:{attackable:"attackable",impossible:"darken"},life:{attackable:"attackable",impossible:"darken"},rainbow:{attackable:"attackable outlined",impossible:"somewhat-darken"}};function y(t){return"fg-"+n.colors(t)}function $(t){return"bg-"+n.colors(t)}let w,k=navigator.userAgent.search("Chrome")>=0,x="dream"+(k?" dream-animation":""),_={};nt.subscribe(t=>{Object.assign(_,t),delete _.goal});let A,M="";function O(){n.undo(),C.length=0,s("particles",C)}function T(t){C.length=0,s("particles",C),h=u=null,s("target",u),s("page",p=t)}function S(){a=!a,ut.set(a)}document.onmousemove=(t=>{b=[t.x,t.y];let e=Math.abs(t.movementX)+Math.abs(t.movementY);!function(){let t=n.figAt(h);h=null,!t||t.resolved||t.none?s("target",u=null):(t.updateAnalysis(),s("target",u=t))}(),function(){let[t,e]=b,n=w?w.offsetWidth:400,r=`left: ${t>window.innerWidth-n-50?t-n-50:t+100}px; top: ${Math.min(e,window.innerHeight-(w?w.offsetHeight:50)-50)}px`;s("analysisPosition",M=r)}(),e>4&&(A&&clearTimeout(A),s("moveTimeout",A=setTimeout(t=>{s("moveTimeout",A=null)},1e3)))});let C=[],j=1;window.onkeydown=(t=>{switch(t.code){case"KeyS":return void T("settings"==p?"board":"settings");case"KeyF":return void T("files"==p?"board":"files");case"KeyB":return void T("board");case"KeyH":return void S();case"KeyU":return void O()}});let P={red:[16711680,16711680],orange:[16744448,16744448],yellow:[16768256,16766720],green:[47872,60928],cyan:[48059,65535],blue:[255,3355647],violet:[12255487,12255487],dream:[48059,65535],none:[16777215,16777215]};for(let t in P)P[t]={fg:ds(P[t][0]),bg:ds(P[t][1])};let N=document.createElement("style");return N.type="text/css",document.getElementsByTagName("head")[0].appendChild(N),N.innerHTML=Object.keys(P).map(t=>`\n    .fg-${t} { color: ${P[t].fg}}\n    .bg-${t} { background: ${P[t].bg}}\n    `).join("\n"),t.$$.update=((t={modes:1,$game:1})=>{(t.modes||t.$game)&&(g=v[n.mode])}),{target:u,page:p,fg:y,bg:$,dream:x,custom:_,clickCell:function(t){if(0==t.button)if(t.shiftKey)n.logFigAt(t.target.id);else{let e=n.attackFigAt(t.target.id);if(e){if(r.sound){let t=e.dream?m:f[Math.floor(2*Math.random())];t.playbackRate=(1+1.3*Math.random())*(e.dream?.5:1),t.volume=.5+Math.random()/2,t.play()}!function(t){if(!t)return;let e=t.deathText,r="death "+(e?$(e.class)||e.class:$(t.kind)),a=[];for(let e of t.cells)a.push({style:`left:${e%n.width*20}px;top:${20*Math.floor(e/n.width)}px;`,class:r,id:j++});e&&a.push({style:`left:${t.cells[0]%n.width*20}px;top:${20*Math.floor(t.cells[0]/n.width)}px;`,class:"flying-text "+(y(e.class)||e.class),content:Tt(e.text),id:j++}),s("particles",C=C.length>30?a:C.concat(a))}(e)}}},hoverCell:function(t){h=t.target.id},unHoverCell:function(t){h=u=null,s("target",u)},analysis:w,analysisPosition:M,moveTimeout:A,undo:O,toPage:T,playCustom:function(){var t;n.wipeAuto(),t=_,window.scrollTo(0,0),window.location.hash="#"+new URLSearchParams(t).toString(),Ft()},toggleWhat:S,cellClasses:function(t){let e=[t.dream?"bg-none":"bg-"+t.color,t.resolved&&!t.dream?"resolved":""];return t.wasted?e.push("wasted"):e=e.concat([t.dream&&t.resolved&&k?"dream-animation":"",1==t.possibility?g.attackable:"",t.dream||t.possibility>0||t.resolved&&t.reached?"":g.impossible]),e=e.filter(t=>""!=t).join(" ")},cellStyle:function(t){if(t.possibility>0&&t.possibility<1){let e=t.dream?P[t.color].bg:"rgba(0,0,0,0.3)";return`box-shadow: inset 0px 0px 0px ${10-8*t.possibility}px ${e};`}return""},particles:C,$game:n,$settings:r,Math:Math,$what:a,$state:i,$conf:o,$debrief:c,$board:d,div2_binding:function(t){L[t?"unshift":"push"](()=>{s("analysis",w=t)})},div_binding:function(t){L[t?"unshift":"push"](()=>{s("analysis",w=t)})},div_binding_1:function(t){L[t?"unshift":"push"](()=>{s("analysis",w=t)})},click_handler:function(t){return T("board")},click_handler_1:function(t){return T("files")},click_handler_2:function(t){return T("settings")},click_handler_3:function(t){return T("board")},click_handler_4:function(t){const e=a=!1;return ut.set(a),e},select_change_handler:function(){_.mode=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),s("custom",_)},input0_input_handler:function(){_.seed=this.value,s("custom",_)},input1_input_handler:function(){_.width=this.value,s("custom",_)},input2_input_handler:function(){_.height=this.value,s("custom",_)},input0_change_handler:function(){ct.update(t=>(t.sound=this.checked,t))},input1_change_handler:function(){ct.update(t=>(t.abridgedAnalysis=this.checked,t))}}}class hs extends X{constructor(t){super(),Q(this,t,us,cs,o,[])}}window.onload=function(){Ft(),new hs({target:document.body})}}();
